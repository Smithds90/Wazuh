---
test_name: GET /sca/000

marks:
  - usefixtures:
    - base_tests

includes:
  - !include common.yaml

stages:

    # Authentication stage
  - type: ref
    id: login_get_token

  - name: Request
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/000"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
    response:
      status_code: 200
      body:
        data: !anything

  - name: Parameters -> limit=2
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/000"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 2
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - &sca_agent_result_000
              name: !anystr
              pass: !anyint
              score: !anyint
              #references: !anystr THIS FIELD IS NOT INCLUDED IN ALL ANSWERS
              fail: !anyint
              description: !anystr
              policy_id: !anystr
              start_scan: !anystr
              end_scan: !anystr
              hash_file: !anystr
              total_checks: !anyint
              invalid: !anyint
            - <<: *sca_agent_result_000

  - name: Parameters -> offset=2,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/000"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        offset: 2
        limit: 1
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_agent_result_000

  - name: Parameters -> sort=-score,limit=2
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/000"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 2
        sort: -score
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_agent_result_000
            - <<: *sca_agent_result_000

  - name: Parameters -> sort=+score,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/000"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 1
        sort: -score
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_agent_result_000

  - name: Parameters -> search=cis,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/000"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 1
        search: cis
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_agent_result_000

  - name: Parameters -> q=score>50,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/000"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 1
        q: score>50
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_agent_result_000

  - name: Parameters -> limit=2500
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/000"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 2500
    response:
      status_code: 400
      body:
        code: 1405
        dapi_errors: !anything
        detail: !anystr
        status: 400
        title: !anystr
        type: !anystr

  - name: Parameters -> name=System audit for SSH hardening,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/000"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 1
        name: System audit for SSH hardening
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_agent_result_000
              name: System audit for SSH hardening

  - name: Parameters -> name=System audit for SSH hardening,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/000"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 1
        references: https://www.ssh.com/ssh/
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_agent_result_000
              references: https://www.ssh.com/ssh/

  - name: Parameters -> description=Guidance for establishing a secure configuration for password vulnerabilities.,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/000"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        description: Guidance for establishing a secure configuration for password vulnerabilities.
        limit: 1
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_agent_result_000
              description: Guidance for establishing a secure configuration for password vulnerabilities.

---
test_name: GET /sca/000/checks/system_audit_pw

stages:

  - name: Request
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/000/checks/system_audit_pw"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
    response:
      status_code: 200
      body:
        data: !anything

  - name: Parameters -> limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/000/checks/system_audit_pw"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 1
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - &sca_check_result_000
              remediation: !anystr
              rationale: !anystr
              title: !anystr
              policy_id: !anystr
              file: !anystr
              description: !anystr
              id: !anyint
              result: !anystr
              compliance: !anything
              rules: !anything
              references: !anystr

  - name: Parameters -> limit=4
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/000/checks/system_audit_pw"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 4
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_check_result_000
              rules:
                - &rule_object_000
                  rule: !anystr
                  type: !anystr
                - <<: *rule_object_000
                - <<: *rule_object_000
                - <<: *rule_object_000

  - name: Parameters -> offset=5,limit=3
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/000/checks/system_audit_pw"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        offset: 5
        limit: 3
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_check_result_000
              rules:
                - <<: *rule_object_000
                - <<: *rule_object_000
                - <<: *rule_object_000

  - name: Parameters -> sort=-id,limit=2
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/000/checks/system_audit_pw"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 2
        sort: -id
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_check_result_000
              rules:
                - <<: *rule_object_000
                - <<: *rule_object_000

  - name: Parameters -> search=passwd,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/000/checks/system_audit_pw"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 1
        search: passwd
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          - <<: *sca_check_result_000

  - name: Parameters -> q=id=13000
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/000/checks/system_audit_pw"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        q: id=13000
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_check_result_000

  - name: Parameters -> result=failed,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/000/checks/system_audit_pw"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 1
        result: failed
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - result: failed

  - name: Parameters -> file=/etc/shadow,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/000/checks/system_audit_pw"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 1
        file: /etc/shadow
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - file: /etc/shadow

  - name: Parameters -> limit=2500
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/000/checks/system_audit_pw"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 2500
    response:
      status_code: 400
      body:
        code: 1405
        dapi_errors: !anything
        detail: !anystr
        status: 400
        title: !anystr
        type: !anystr

  - name: Parameters -> references=https://www.thegeekdiary.com/understanding-etclogin-defs-file,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/000/checks/system_audit_pw"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 1
        references: https://www.thegeekdiary.com/understanding-etclogin-defs-file
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_check_result_000
              references: https://www.thegeekdiary.com/understanding-etclogin-defs-file

  - name: Parameters -> title=Ensure password hashing algorithm is SHA-512,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/000/checks/system_audit_pw"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 1
        title: Ensure password hashing algorithm is SHA-512
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_check_result_000
              title: Ensure password hashing algorithm is SHA-512

  - name: Parameters -> remediation=Set the PASS_MAX_DAYS parameter to conform to site policy in /etc/login.defs.,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/000/checks/system_audit_pw"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 1
        remediation: Set the PASS_MAX_DAYS parameter to conform to site policy in /etc/login.defs.
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_check_result_000
              remediation: Set the PASS_MAX_DAYS parameter to conform to site policy in /etc/login.defs.

---
test_name: GET /sca/001


stages:

  - name: Request
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/001"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
    response:
      status_code: 200
      body:
        data: !anything

  - name: Parameters -> limit=2
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/001"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 2
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - &sca_agent_result_001
              name: !anystr
              pass: !anyint
              score: !anyint
              #references: !anystr THIS FIELD IS NOT INCLUDED IN ALL ANSWERS
              fail: !anyint
              description: !anystr
              policy_id: !anystr
              start_scan: !anystr
              end_scan: !anystr
              hash_file: !anystr
              total_checks: !anyint
              invalid: !anyint
            - <<: *sca_agent_result_001

  - name: Parameters -> offset=2,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/001"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        offset: 2
        limit: 1
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_agent_result_001

  - name: Parameters -> sort=-score,limit=2
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/001"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 2
        sort: -score
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_agent_result_001
            - <<: *sca_agent_result_001

  - name: Parameters -> sort=+score,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/001"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 1
        sort: -score
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_agent_result_001

  - name: Parameters -> search=cis,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/001"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 1
        search: cis
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_agent_result_001

  - name: Parameters -> q=score=33,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/001"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 1
        q: score=33
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_agent_result_001

  - name: Parameters -> limit=2500
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/001"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 2500
    response:
      status_code: 400
      body:
        code: 1405
        dapi_errors: !anything
        detail: !anystr
        status: 400
        title: !anystr
        type: !anystr

  - name: Parameters -> name=System audit for password-related vulnerabilities,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/001"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 1
        name: System audit for password-related vulnerabilities
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_agent_result_001
              name: System audit for password-related vulnerabilities

  - name: Parameters -> description=Guidance for establishing a secure configuration for password vulnerabilities.,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/001"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        description: Guidance for establishing a secure configuration for password vulnerabilities.
        limit: 1
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_agent_result_001
              description: Guidance for establishing a secure configuration for password vulnerabilities.

---
---
---
test_name: GET /sca/001/checks/system_audit

stages:

  - name: Request
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/001/checks/system_audit"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
    response:
      status_code: 200
      body:
        data: !anything

  - name: Parameters -> limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/001/checks/system_audit"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 1
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - &sca_check_result_001
              title: !anystr
              policy_id: !anystr
              id: !anyint
              result: !anystr
              compliance: !anything
              rules: !anything
              references: !anystr
              directory: !anystr
              status: !anystr
              reason: !anystr

  - name: Parameters -> limit=2
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/001/checks/system_audit"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 2
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_check_result_001
            - <<: *sca_check_result_001
              rules:
                - &rule_object_001
                  rule: !anystr
                  type: !anystr

  - name: Parameters -> sort=-id,limit=2
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/001/checks/system_audit"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 2
        sort: -id
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_check_result_001
              rules:
                - <<: *rule_object_001
            - <<: *sca_check_result_001

  - name: Parameters -> search=passwd,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/001/checks/system_audit"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 1
        search: passwd
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          - <<: *sca_check_result_001

  - name: Parameters -> q=id=13001
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/001/checks/system_audit"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        q: id=1015
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_check_result_001

  - name: Parameters -> limit=2500
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/001/checks/system_audit"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 2500
    response:
      status_code: 400
      body:
        code: 1405
        dapi_errors: !anything
        detail: !anystr
        status: 400
        title: !anystr
        type: !anystr

  - name: Parameters -> references=https://blog.sucuri.net/2011/05/understanding-htaccess-attacks-part-1.html,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/001/checks/system_audit"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 1
        references: https://blog.sucuri.net/2011/05/understanding-htaccess-attacks-part-1.html
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_check_result_001
              references: https://blog.sucuri.net/2011/05/understanding-htaccess-attacks-part-1.html

  - name: Parameters -> title=Web vulnerability - .htaccess file compromised - auto append,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/001/checks/system_audit"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 1
        title: Web vulnerability - .htaccess file compromised - auto append
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_check_result_001
              title: Web vulnerability - .htaccess file compromised - auto append

---
test_name: GET /sca/002


stages:

  - name: Request
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/002"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
    response:
      status_code: 200
      body:
        data: !anything

  - name: Parameters -> limit=2
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/002"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 2
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - &sca_agent_result_002
              name: !anystr
              pass: !anyint
              score: !anyint
              #references: !anystr THIS FIELD IS NOT INCLUDED IN ALL ANSWERS
              fail: !anyint
              description: !anystr
              policy_id: !anystr
              start_scan: !anystr
              end_scan: !anystr
              hash_file: !anystr
              total_checks: !anyint
              invalid: !anyint
            - <<: *sca_agent_result_002

  - name: Parameters -> offset=2,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/002"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        offset: 2
        limit: 1
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_agent_result_002

  - name: Parameters -> sort=-score,limit=2
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/002"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 2
        sort: -score
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_agent_result_002
            - <<: *sca_agent_result_002

  - name: Parameters -> sort=+score,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/002"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 1
        sort: -score
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_agent_result_002

  - name: Parameters -> search=cis,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/002"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 1
        search: cis
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_agent_result_002

  - name: Parameters -> q=score=33,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/002"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 1
        q: score=33
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_agent_result_002

  - name: Parameters -> limit=2500
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/002"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 2500
    response:
      status_code: 400
      body:
        code: 1405
        dapi_errors: !anything
        detail: !anystr
        status: 400
        title: !anystr
        type: !anystr

  - name: Parameters -> name=System audit for password-related vulnerabilities,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/002"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 1
        name: System audit for password-related vulnerabilities
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_agent_result_002
              name: System audit for password-related vulnerabilities

  - name: Parameters -> description=Guidance for establishing a secure configuration for password vulnerabilities.,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/002"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        description: Guidance for establishing a secure configuration for password vulnerabilities.
        limit: 1
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_agent_result_002
              description: Guidance for establishing a secure configuration for password vulnerabilities.

---
test_name: GET /sca/002/checks/system_audit

stages:

  - name: Request
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/002/checks/system_audit"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
    response:
      status_code: 200
      body:
        data: !anything

  - name: Parameters -> limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/002/checks/system_audit"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 1
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - &sca_check_result_002
              title: !anystr
              policy_id: !anystr
              id: !anyint
              result: !anystr
              compliance: !anything
              rules: !anything
              references: !anystr
              directory: !anystr
              status: !anystr
              reason: !anystr

  - name: Parameters -> limit=2
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/002/checks/system_audit"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 2
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_check_result_002
            - <<: *sca_check_result_002
              rules:
                - &rule_object_002
                  rule: !anystr
                  type: !anystr

  - name: Parameters -> sort=-id,limit=2
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/002/checks/system_audit"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 2
        sort: -id
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_check_result_002
              rules:
                - <<: *rule_object_002
            - <<: *sca_check_result_002

  - name: Parameters -> search=passwd,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/002/checks/system_audit"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 1
        search: passwd
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          - <<: *sca_check_result_002

  - name: Parameters -> q=id=13002
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/002/checks/system_audit"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        q: id=1015
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_check_result_002

  - name: Parameters -> limit=2500
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/002/checks/system_audit"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 2500
    response:
      status_code: 400
      body:
        code: 1405
        dapi_errors: !anything
        detail: !anystr
        status: 400
        title: !anystr
        type: !anystr

  - name: Parameters -> references=https://blog.sucuri.net/2011/05/understanding-htaccess-attacks-part-1.html,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/002/checks/system_audit"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 1
        references: https://blog.sucuri.net/2011/05/understanding-htaccess-attacks-part-1.html
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_check_result_002
              references: https://blog.sucuri.net/2011/05/understanding-htaccess-attacks-part-1.html

  - name: Parameters -> title=Web vulnerability - .htaccess file compromised - auto append,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/002/checks/system_audit"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 1
        title: Web vulnerability - .htaccess file compromised - auto append
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_check_result_002
              title: Web vulnerability - .htaccess file compromised - auto append

---
test_name: GET /sca/003


stages:

  - name: Request
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/003"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
    response:
      status_code: 200
      body:
        data: !anything

  - name: Parameters -> limit=2
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/003"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 2
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - &sca_agent_result_003
              name: !anystr
              pass: !anyint
              score: !anyint
              #references: !anystr THIS FIELD IS NOT INCLUDED IN ALL ANSWERS
              fail: !anyint
              description: !anystr
              policy_id: !anystr
              start_scan: !anystr
              end_scan: !anystr
              hash_file: !anystr
              total_checks: !anyint
              invalid: !anyint
            - <<: *sca_agent_result_003

  - name: Parameters -> offset=2,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/003"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        offset: 2
        limit: 1
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_agent_result_003

  - name: Parameters -> sort=-score,limit=2
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/003"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 2
        sort: -score
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_agent_result_003
            - <<: *sca_agent_result_003

  - name: Parameters -> sort=+score,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/003"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 1
        sort: -score
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_agent_result_003

  - name: Parameters -> search=cis,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/003"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 1
        search: cis
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_agent_result_003

  - name: Parameters -> q=score=33,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/003"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 1
        q: score=33
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_agent_result_003

  - name: Parameters -> limit=2500
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/003"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 2500
    response:
      status_code: 400
      body:
        code: 1405
        dapi_errors: !anything
        detail: !anystr
        status: 400
        title: !anystr
        type: !anystr

  - name: Parameters -> name=System audit for password-related vulnerabilities,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/003"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 1
        name: System audit for password-related vulnerabilities
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_agent_result_003
              name: System audit for password-related vulnerabilities

  - name: Parameters -> description=Guidance for establishing a secure configuration for password vulnerabilities.,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/003"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        description: Guidance for establishing a secure configuration for password vulnerabilities.
        limit: 1
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_agent_result_003
              description: Guidance for establishing a secure configuration for password vulnerabilities.

---
test_name: GET /sca/003/checks/system_audit

stages:

  - name: Request
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/003/checks/system_audit"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
    response:
      status_code: 200
      body:
        data: !anything

  - name: Parameters -> limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/003/checks/system_audit"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 1
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - &sca_check_result_003
              title: !anystr
              policy_id: !anystr
              id: !anyint
              result: !anystr
              compliance: !anything
              rules: !anything
              references: !anystr
              directory: !anystr
              status: !anystr
              reason: !anystr

  - name: Parameters -> limit=2
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/003/checks/system_audit"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 2
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_check_result_003
            - <<: *sca_check_result_003
              rules:
                - &rule_object_003
                  rule: !anystr
                  type: !anystr

  - name: Parameters -> sort=-id,limit=2
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/003/checks/system_audit"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 2
        sort: -id
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_check_result_003
              rules:
                - <<: *rule_object_003
            - <<: *sca_check_result_003

  - name: Parameters -> search=passwd,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/003/checks/system_audit"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 1
        search: passwd
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          - <<: *sca_check_result_003

  - name: Parameters -> q=id=13003
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/003/checks/system_audit"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        q: id=1015
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_check_result_003

  - name: Parameters -> limit=2500
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/003/checks/system_audit"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 2500
    response:
      status_code: 400
      body:
        code: 1405
        dapi_errors: !anything
        detail: !anystr
        status: 400
        title: !anystr
        type: !anystr

  - name: Parameters -> references=https://blog.sucuri.net/2011/05/understanding-htaccess-attacks-part-1.html,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/003/checks/system_audit"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 1
        references: https://blog.sucuri.net/2011/05/understanding-htaccess-attacks-part-1.html
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_check_result_003
              references: https://blog.sucuri.net/2011/05/understanding-htaccess-attacks-part-1.html

  - name: Parameters -> title=Web vulnerability - .htaccess file compromised - auto append,limit=1
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/003/checks/system_audit"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        limit: 1
        title: Web vulnerability - .htaccess file compromised - auto append
    response:
      status_code: 200
      body:
        data:
          totalItems: !anyint
          items:
            - <<: *sca_check_result_003
              title: Web vulnerability - .htaccess file compromised - auto append
