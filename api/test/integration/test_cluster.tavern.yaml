---
test_name: GET /cluster/node

stages:

  - name: Request

    request:
      url: http://localhost:55000/cluster/node
      method: GET

    response:
      status_code: 200
      body:
        cluster: wazuh
        node: master
        type: master

---
test_name: GET /cluster/nodes

stages:

  - name: Request

    request:
      url: http://localhost:55000/cluster/nodes
      method: GET

    response:
      status_code: 200
      body:
        data:
          totalItems: 2
          items:
            -
              ip: !anystr
              version: !anystr
              type: worker
              name: !anystr
            -
              ip: !anystr
              version: !anystr
              type: master
              name: !anystr

  - name: Retrieve all elements with limit=0

    request:
      url: http://localhost:55000/cluster/nodes
      method: GET
      params:
        limit: 0

    response:
      status_code: 400
      body:
        detail: !anystr
        status: 400
        title: !anystr
        type: !anystr

  - name: Sort 1

    request:
      url: http://localhost:55000/cluster/nodes
      method: GET
      params:
        sort: name

    response:
      status_code: 200
      body:
        data:
          items:
            -
              ip: !anystr
              version: !anystr
              type: master
              name: !anystr
            -
              ip: !anystr
              version: !anystr
              type: worker
              name: !anystr

  - name: Sort 2

    request:
      url: http://localhost:55000/cluster/nodes
      method: GET
      params:
        sort: -name

    response:
      status_code: 200
      body:
        data:
          items:
            -
              ip: !anystr
              version: !anystr
              type: worker
              name: !anystr
            -
              ip: !anystr
              version: !anystr
              type: master
              name: !anystr

  - name: Search 1

    request:

      url: http://localhost:55000/cluster/nodes
      method: GET
      params:
        search: master

    response:
      status_code: 200
      body:
        data:
          totalItems:
          items:
            - ip: !anystr
              version: !anystr
              type: master
              name: !anystr

  - name: Search 2

    request:

      url: http://localhost:55000/cluster/nodes
      method: GET
      params:
        search: worker

    response:
      status_code: 200
      body:
        data:
          totalItems:
          items:
            - ip: !anystr
              version: !anystr
              type: worker
              name: !anystr

  - name: Filters (type) -> master

    request:
      url: http://localhost:55000/cluster/nodes
      method: GET
      params:
        type: master

    response:
      status_code: 200
      body:
        data:
          totalItems: 1
          items:
            -
              ip: !anystr
              version: !anystr
              type: master
              name: !anystr

  - name: Filters (type) -> worker

    request:
      url: http://localhost:55000/cluster/nodes
      method: GET
      params:
        limit: 1
        type: worker

    response:
      status_code: 200
      body:
        data:
          totalItems: 1
          items:
            -
              ip: !anystr
              version: !anystr
              type: worker
              name: !anystr

  - name: Filters -> invalid type

    request:
      url: http://localhost:55000/cluster/nodes
      method: GET
      params:
        type: wrong_type

    response:
      status_code: 400
      body:
        detail: !anystr
        status: 400
        title: !anystr
        type: !anystr

  - name: Select

    request:
      url: http://localhost:55000/cluster/nodes
      method: GET
      params:
        select: name,version

    response:
      status_code: 200
      body:
        data:
          totalItems: 2
          items:
            -
              name: !anystr
              version: !anystr
            -
              name: !anystr
              version: !anystr

  - name: Select 2

    request:
      url: http://localhost:55000/cluster/nodes
      method: GET
      params:
        select: type

    response:
      status_code: 200
      body:
        data:
          totalItems: 2
          items:
            -
              type: !anystr
            -
              type: !anystr

#  - name: Wrong select
#
#    request:
#      url: http://localhost:55000/cluster/nodes
#      method: GET
#      params:
#        select: wrong_field
#
#    response:
#      status_code: 400
#      body:
#        detail: !anystr
#        status: 400
#        title: !anystr
#        type: !anystr

---
#test_name: GET /cluster/{node_id}/stats
#stages:
#  - name: Cluster stats (master)
#
#    request:
#      url: http://localhost:55000/cluster/{node_id}/stats
#      method: GET
#      params:
#        node_id: master
#
#    response:
#        status_code: 200
#        data:
#          body:
#            - hour:
#              alerts:
#                - sigid:
#                  level:
#                  times:
#                - sigid:
#                  level:
#                  times:
#                - sigid:
#                  level:
#                  times:
#              totalAlerts:
#              events:
#              firewall:
#            - hour:
#              alerts:
#                - sigid:
#                  level:
#                  times:
#                - sigid:
#                  level:
#                  times:
#              totalAlerts:
#              events:
#              syscheck:
#              firewall:

#  - name: Cluster stats (worker)
#
#    request:
#      url: http://localhost:55000/cluster/{node_id}/stats
#      method: GET
#      params:
#        node_id: master
#
#    response:
#        status_code: 200
#        body:
#          - hour:
#            alerts:
#              - sigid:
#                level:
#                times:
#              - sigid:
#                level:
#                times:
#              - sigid:
#                level:
#                times:
#            totalAlerts:
#            events:
#            firewall:
#          - hour:
#            alerts:
#              - sigid:
#                level:
#                times:
#              - sigid:
#                level:
#                times:
#            totalAlerts:
#            events:
#            syscheck:
#            firewall:

#  - name: Unexisting node stats
#
#    request:
#      url: http://localhost:55000/cluster/{node_id}/stats
#      method: GET
#      params:
#        node_id: unexisting_node
#
#    response:
#        status_code: 400
#        body:
#          code: 3022
#          dapi_errors:
#          detail: !anystr
#          title: !anystr
#          type: !anystr
#
#  - name: Hourly node stats
#
#    request:
#      url: http://localhost:55000/cluster/{node_id}/stats/hourly
#      method: GET
#      params:
#        node_id: master
#
#    response:
#        status_code: 200
#        body:
#          averages:
#            -
#          interactions: 0
#
#  - name: Weekly node stats
#
#    request:
#      url: http://localhost:55000/cluster/{node_id}/stats/weekly
#      method: GET
#      params:
#        node_id: master
#
#    response:
#        status_code: 200
#        body:

#  - name: Analysisd stats (master)
#
#    request:
#      url: http://localhost:55000/cluster/master/stats/analysisd
#      method: GET
#      params:
#        node_id: master
#
#    response:
#        status_code: 200
#        body:
#          data:
#            total_events_decoded: !anyint
#            syscheck_events_decoded: !anyint
#            syscheck_edps: !anyint
#            syscollector_events_decoded: !anyint
#            syscollector_edps: !anyint
#            rootcheck_events_decoded: !anyint
#            rootcheck_edps: !anyint
#            sca_events_decoded: !anyint
#            sca_edps: !anyint
#            hostinfo_events_decoded: !anyint
#            hostinfo_edps: !anyint
#            winevt_events_decoded: !anyint
#            winevt_edps: !anyint
#            other_events_decoded: !anyint
#            other_events_edps: !anyint
#            events_processed: !anyint
#            events_edps: !anyint
#            events_received: !anyint
#            events_dropped: !anyint
#            alerts_written: !anyint
#            firewall_written: !anyint
#            fts_written: !anyint
#            syscheck_queue_usage: !anyint
#            syscheck_queue_size: !anyint
#            syscollector_queue_usage: !anyint
#            syscollector_queue_size: !anyint
#            rootcheck_queue_usage: !anyint
#            rootcheck_queue_size: !anyint
#            sca_queue_usage: !anyint
#            sca_queue_size: !anyint
#            hostinfo_queue_usage: !anyint
#            hostinfo_queue_size: !anyint
#            winevt_queue_usage: !anyint
#            winevt_queue_size: !anyint
#            event_queue_usage: !anyint
#            event_queue_size: !anyint
#            rule_matching_queue_usage: !anyint
#            rule_matching_queue_size: !anyint
#            alerts_queue_usage: !anyint
#            alerts_queue_size: !anyint
#            firewall_queue_usage: !anyint
#            firewall_queue_size: !anyint
#            statistical_queue_usage: !anyint
#            statistical_queue_size: !anyint
#            archives_queue_usage: !anyint
#            archives_queue_size: !anyint
#
#  - name: Remoted stats (master)
#
#    request:
#      url: http://localhost:55000/cluster/{node_id}/stats/remoted
#      method: GET
#      params:
#        node_id: master
#
#    response:
#        status_code: 200
#        body:
#          queue_size: !anyint
#          total_queue_size: !anyint
#          tcp_sessions: !anyint
#          evt_count: !anyint
#          ctrl_msg_count: !anyint
#          discarded_count: !anyint
#          msg_sent: !anyint
#          recv_bytes: !anyint
#

