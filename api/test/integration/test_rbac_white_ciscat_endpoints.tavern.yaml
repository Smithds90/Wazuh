---
test_name: GET /ciscat/agent_id/results

marks:
  - usefixtures:
    - ciscat_white_rbac_tests

includes:
 - !include common.yaml

stages:

  # Authentication stage
  - type: ref
    id: login_get_token

  - name: Get ciscat result for agent 001 (allowed)
    request:
      url: "{protocol:s}://{host:s}:{port:d}/ciscat/001/results"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
    response:
      status_code: 200
      body:
        data:
          affected_items: !anything
          failed_items: !anything
          total_affected_items: !anyint
          total_failed_items: 0
        message: All CISCAT results loaded

  - name: Get ciscat result for agent 002 (allowed)
    request:
      url: "{protocol:s}://{host:s}:{port:d}/ciscat/002/results"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
    response:
      status_code: 200
      body:
        data:
          affected_items: !anything
          failed_items: !anything
          total_affected_items: !anyint
          total_failed_items: 0
        message: All CISCAT results loaded

  - name: Get ciscat result for agent 003 (denied)
    request:
      url: "{protocol:s}://{host:s}:{port:d}/ciscat/003/results"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
    response:
      status_code: 400
      body:
        code: 4000
        detail: "Permission denied"


