---
test_name: GET /sca/{agent_id}

includes:
  - !include common.yaml

marks:
  - usefixtures:
    - sca_white_rbac_tests

stages:

    # Authentication stage
  - type: ref
    id: login_get_token

  - name: Request sca for agent 000 (Allowed)
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/000"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
    response:
      status_code: 200
      body:
        data: !anything

  - name: Request sca for agent 001 (Denied)
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/001"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
    response:
      status_code: 400
      body:
        code: 4000
        detail: !anystr

  - name: Request sca for agent 002 (Allowed)
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/002"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
    response:
      status_code: 200
      body:
        data: !anything

  - name: Request sca for agent 003 (Denied)
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/003"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
    response:
      status_code: 400
      body:
        code: 4000
        detail: !anystr

  - name: Request sca for agent 003 (Denied)
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/003"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
    response:
      status_code: 400
      body:
        code: 4000
        detail: !anystr

  - name: Request sca for agent 005 (Allowed)
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/005"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
    response:
      status_code: 200
      body:
        data: !anything

---
test_name: GET /sca/{agent_id}/checks/{policy_id}

stages:

  - name: Request policy checks for 000 (Allowed)
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/000/checks/cis_debian9_L1"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
    response:
      status_code: 200
      body:
        data: !anything

  - name: Request policy checks for 001 (Denied)
    request:
      url: "{protocol:s}://{host:s}:{port:d}/sca/001/checks/cis_debian9_L1"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
    response:
      status_code: 400
      body:
        code: 4000
        detail: !anystr
