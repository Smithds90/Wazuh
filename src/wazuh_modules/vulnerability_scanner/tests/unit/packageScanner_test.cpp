/*
 * Wazuh Vulnerability Scanner - Unit Tests
 * Copyright (C) 2015, Wazuh Inc.
 * September 21, 2023.
 *
 * This program is free software; you can redistribute it
 * and/or modify it under the terms of the GNU General Public
 * License (version 2) as published by the FSF - Free Software
 * Foundation.
 */

#include "packageScanner_test.hpp"
#include "scanOrchestrator/packageScanner.hpp"
#include "scanOrchestrator/scanContext.hpp"
#include <memory>
#include <string>
#include <vector>

/*
 * @brief Test instantion of the PackageScanner class.
 */
TEST_F(PackageScannerTest, TestInstantionOfThePackageScannerClass)
{
    // Instantion of the PackageScanner class.
    EXPECT_NO_THROW(std::make_shared<PackageScanner>());
}

/*
 * @brief Test handleRequest of the PackageScanner class.
 */
TEST_F(PackageScannerTest, TestHandleRequest)
{
    std::string data {R"({"type":"dbsync_packages"})"};
    std::vector<char> message(50, ' ');
    std::copy(data.begin(), data.end(), message.begin() + 15);

    std::shared_ptr<ScanContext> scanContext;

    // Instantion of the ScanContext struct.
    EXPECT_NO_THROW(scanContext = std::make_shared<ScanContext>());

    // TODO: Remove the comment below once the implementation of ScanContext is completed
    // EXPECT_NO_THROW(scanContext->build(message));

    std::shared_ptr<PackageScanner> packageScanner;

    // Instantion of the PackageScanner class.
    EXPECT_NO_THROW(packageScanner = std::make_shared<PackageScanner>());

    // HandleRequest
    EXPECT_NO_THROW(packageScanner->handleRequest(scanContext));
}
