# RTR
This module, and its dependencies:
- [router](../../../shared_modules/router/)
- [indexer_connector](../../../shared_modules/indexer_connector/)
- [content_manager](../../../shared_modules/content_manager/)

Are tested in the [following wokflow](../../../../.github/workflows/vulnerability-scanner-tests.yml).

In order to facilitate the code development, the workflow is prepared to be executed locally (see [dependencies](#dependencies)).

## Dependencies

### ACT
1. Download the binary: 
  `wget -qO act.tar.gz https://github.com/nektos/act/releases/latest/download/act_Linux_x86_64.tar.gz`

2. Extract the binary into the system binaries folder:
  `sudo tar xf act.tar.gz -C /usr/local/bin act`

3. Remove the unnecessary files:
  `rm -rf act.tar.gz`
  
4. On the first execution, select the medium image


## Usage

The following command will trigger the workflow and perform the exact same steps as the CI/CD pipeline:

> **Note**: These commands must be executed from the root of the repository.

```bash
# General usage
act -W <path_to_workflow> --artifact-server-path <artifacts_location> --env REF_BRANCH=<base_branch> (optional) -v (optional)

# Practical aplication
act -W .github/workflows/vulnerability-scanner-tests.yml --artifact-server-path /tmp/artifacts
```

### Arguments
- `-W <path_to_workflow>`: Path to the workflow to be executed.
- `-v`: Enables the verbose mode. It's recommended to use it on the first run in order to see the progress of the docker images being pulled (it takes some time on the first run).
- `--env REF_BRANCH`: The branch the changes are compared against. If not provided, the comparison is against the `master` branch.
- `--artifact-server-path`: Path where the artifacts will be stored. This path must be accessible by the user running the workflow.
    -  **Note**: Artifacts are compressed in a weird way (the extension of the generated files is gz__). In order to extract them, the following commands must be executed:
    ```bash
    find <path to the artifacts> -type f -name "*.gz__" | while read file; do mv "$file" "${file%.gz__}.gz"; done
    find <path to the artifacts> -type f -name "*.gz" -exec gunzip {} -f +
    ```
