name: syscollector_dbsync_hotfixes_inserted

parents:
  - syscollector_dbsync_base

check:
  - _json.type: +s_eq/dbsync_hotfixes
  - _json.operation: +s_eq/INSERTED

normalize:
  - check:
      - _json.data.scan_time: +not_exists
    map:
      _json.data.scan_time: ""

  - check:
      - _json.data.hotfix: +s_ne//
    map:
      _json.data.hotfix: +s_replace/|/$_escaped_pipe_char
      _json.data.hotfix: +s_replace/NULL/_NULL_
  - check:
      - _json.data.hotfix: +s_eq//
    map:
      _json.data.hotfix: "NULL"
  - check:
      - _json.data.hotfix: +not_exists
    map:
      _json.data.hotfix: ""

  - check:
      - _json.data.checksum: +not_exists
    map:
      _json.data.checksum: ""

  - map:
      _query: +s_concat/agent /$agent.id/ dbsync hotfixes /$_json.operation/ /$_json.data.scan_time/|/$_json.data.hotfix/|/$_json.data.checksum/|
      _query_response: +wdb_update/$_query

  - check:
      - _query_response: +is_true
    map:
      #TODO: need to find where to map resultant neccesary fields
      _json.data.hotfix: +s_replace/$_escaped_pipe_char/|
      _query: +delete_field
      _query_response: +delete_field
      _escaped_pipe_char: +delete_field
