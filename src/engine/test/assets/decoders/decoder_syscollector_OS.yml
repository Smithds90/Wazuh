name: decoder_syscollector_osinfo
check:
  - wazuh.queue: +i_eq/64 #SYSCOLLECTOR_MQ
  - event.original.route: +s_eq/syscollector
  - location: +exists

normalize:
  # decode_osinfo
  #ID (scan_id)
  # type == OS
  - check:
    - event.original.type: +s_eq/OS
    - event.original.inventory: +exists
    - event.original.ID: +exists
    map:
      _decode_osinfo_section: 1

    #scan_id
  - check:
    - event.original.inventory: +exist
    - event.original.ID: +not_exists
    map:
      event.original.ID: "NULL"

    #timestamp
  - check:
    - event.original.inventory: +exist
    - event.original.timestamp: +not_exists
    map:
      event.original.timestamp: "NULL"

    #fill os.hostname
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.hostname: +exists
    map:
      event.original.hardware.hostname: $event.original.inventory.hostname
    #inventory.hostname
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.hostname: +not_exists
    map:
      event.original.inventory.hostname: "NULL"

    #fill inventory.architecture
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.architecture: +exists
    map:
      event.original.hadrware.architecture: event.original.inventory.architecture
    #inventory.architecture
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.architecture: +not_exists
    map:
      event.original.inventory.architecture: "NULL"

    #fill hardware.cpu_cores
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.cpu_cores: +exists
    map:
      event.original.hardware.cpu_cores: event.original.inventory.cpu_cores
    #inventory.cpu_cores
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.cpu_cores: +not_exists
    map:
      event.original.inventory.cpu_cores: "NULL"

    #fill os.name
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.os_name: +exists
    map:
      event.original.os.name: event.original.inventory.os_name
    #inventory.os_name
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.os_name: +not_exists
    map:
      event.original.inventory.os_name: "NULL"

    #fill os.version
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.os_version: +exists
    map:
      event.original.os.version: event.original.inventory.os_version
    #inventory.os_version
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.os_version: +not_exists
    map:
      event.original.inventory.os_version: "NULL"

    #fill os.codename
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.os_codename: +exists
    map:
      event.original.os.codename: event.original.inventory.os_codename
    #inventory.os_codename
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.os_codename: +not_exists
    map:
      event.original.inventory.os_codename: "NULL"

    #fill os.major
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.os_major: +exists
    map:
      event.original.os.major: event.original.inventory.os_major
    #inventory.os_major
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.os_major: +not_exists
    map:
      event.original.inventory.os_major: "NULL"

    #fill os.minor
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.os_minor: +exists
    map:
      event.original.os.minor: event.original.inventory.os_minor
    #inventory.os_minor
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.os_minor: +not_exists
    map:
      event.original.inventory.os_minor: "NULL"

    #fill os.build
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.os_build: +exists
    map:
      event.original.os.build: event.original.inventory.os_build
    #inventory.os_build
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.os_build: +not_exists
    map:
      event.original.inventory.os_build: "NULL"

    #fill os.platform
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.os_platform: +exists
    map:
      event.original.os.platform: event.original.inventory.os_platform
    #inventory.os_platform
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.os_platform: +not_exists
    map:
      event.original.inventory.os_platform: "NULL"

    #fill os.sysname
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.sysname: +exists
    map:
      event.original.os.sysname: event.original.inventory.sysname
    #inventory.sysname
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.sysname: +not_exists
    map:
      event.original.inventory.sysname: "NULL"

    #fill os.release
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.release: +exists
    map:
      event.original.os.release: event.original.inventory.release
    #inventory.release
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.release: +not_exists
    map:
      event.original.inventory.release: "NULL"

    #fill os.release_version
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.version: +exists
    map:
      event.original.os.release_version: event.original.inventory.version
    #inventory.version
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.version: +not_exists
    map:
      event.original.inventory.version: "NULL"

    #fill os.os_release
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.os_release: +exists
    map:
      event.original.os.os_release: event.original.inventory.os_release
    #inventory.os_release
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.os_release: +not_exists
    map:
      event.original.inventory.os_release: "NULL"

    #fill os.patch
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.os_patch: +exists
    map:
      event.original.os.patch: event.original.inventory.os_patch
    #inventory.os_patch
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.os_patch: +not_exists
    map:
      event.original.inventory.os_patch: "NULL"

    #fill os.display_version
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.os_display_version: +exists
    map:
      event.original.os.display_version: event.original.inventory.os_display_version
    #inventory.os_display_version
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.os_display_version: +not_exists
    map:
      event.original.inventory.os_display_version: "NULL"

  - check:
    - _decode_osinfo_section: +i_eq/1
    - event.original.inventory: +exist
    map:
      _query_set: +s_concat/agent /$event.original.agent.id /osinfo set /$event.original.ID/|$event.original.timestamp/|$event.original.inventory.hostname/|$event.original.inventory.architecture/|$event.original.inventory.os_name/|$event.original.inventory.os_version/|$event.original.inventory.os_codename/|$event.original.inventory.os_major/|$event.original.inventory.os_minor/|$event.original.inventory.os_build/|$event.original.inventory.os_platform/|$event.original.inventory.sysname/|$event.original.inventory.release/|$event.original.inventory.version/|$event.original.inventory.os_release/|$event.original.inventory.os_patch/|$event.original.inventory.os_display_version
      _hardware_save_response: +wdb_update/$_query_set
