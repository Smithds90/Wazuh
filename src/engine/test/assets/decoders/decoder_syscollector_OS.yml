name: decoder_syscollector_osinfo

parents:
  - decoder_syscollector_base

check:
  - type: +exists
  - event.original.route: +s_eq/syscollector
  - location: +exists

normalize:
  # decode_osinfo
  #ID (scan_id)
  # type == OS
  - check:
    - event.original.type: +s_eq/OS
    - event.original.inventory: +exists
    - event.original.ID: +exists
    map:
      _decode_osinfo_section: 1

    #scan_id
  - check:
    - event.original.inventory: +exist
    - event.original.ID: +not_exists
    map:
      event.original.ID: "NULL"

    #timestamp
  - check:
    - event.original.inventory: +exist
    - event.original.timestamp: +not_exists
    map:
      event.original.timestamp: "NULL"

    #inventory.hostname
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.hostname: +not_exists
    map:
      event.original.inventory.hostname: "NULL"

    #inventory.architecture
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.architecture: +not_exists
    map:
      event.original.inventory.architecture: "NULL"

    #inventory.cpu_cores
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.cpu_cores: +not_exists
    map:
      event.original.inventory.cpu_cores: "NULL"

    #inventory.os_name
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.os_name: +not_exists
    map:
      event.original.inventory.os_name: "NULL"

    #inventory.os_version
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.os_version: +not_exists
    map:
      event.original.inventory.os_version: "NULL"

    #inventory.os_codename
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.os_codename: +not_exists
    map:
      event.original.inventory.os_codename: "NULL"

    #inventory.os_major
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.os_major: +not_exists
    map:
      event.original.inventory.os_major: "NULL"

    #inventory.os_minor
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.os_minor: +not_exists
    map:
      event.original.inventory.os_minor: "NULL"

    #inventory.os_build
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.os_build: +not_exists
    map:
      event.original.inventory.os_build: "NULL"

    #inventory.os_platform
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.os_platform: +not_exists
    map:
      event.original.inventory.os_platform: "NULL"

    #inventory.sysname
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.sysname: +not_exists
    map:
      event.original.inventory.sysname: "NULL"

    #inventory.release
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.release: +not_exists
    map:
      event.original.inventory.release: "NULL"

    #inventory.version
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.version: +not_exists
    map:
      event.original.inventory.version: "NULL"

    #inventory.os_release
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.os_release: +not_exists
    map:
      event.original.inventory.os_release: "NULL"

    #inventory.os_patch
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.os_patch: +not_exists
    map:
      event.original.inventory.os_patch: "NULL"

    #inventory.os_display_version
  - check:
    - event.original.inventory: +exist
    - event.original.inventory.os_display_version: +not_exists
    map:
      event.original.inventory.os_display_version: "NULL"

  - check:
    - _decode_osinfo_section: +i_eq/1
    - event.original.inventory: +exist
    map:
      _query_set: +s_concat/agent /$event.original.agent.id /osinfo set /$event.original.ID/|$event.original.timestamp/|$event.original.inventory.hostname/|$event.original.inventory.architecture/|$event.original.inventory.os_name/|$event.original.inventory.os_version/|$event.original.inventory.os_codename/|$event.original.inventory.os_major/|$event.original.inventory.os_minor/|$event.original.inventory.os_build/|$event.original.inventory.os_platform/|$event.original.inventory.sysname/|$event.original.inventory.release/|$event.original.inventory.version/|$event.original.inventory.os_release/|$event.original.inventory.os_patch/|$event.original.inventory.os_display_version
      _hardware_save_response: +wdb_update/$_query_set
