---
name: decoder/apache-error/0

metadata:
  description: Parses Apache HTTPD errors logs in its Common Log Format

check:
  - wazuh.queue: 49
  - event.original: +ef_exists

parse:
  logpar:
      # [Fri Jul 10 22:07:08.694043 1992] [core:notice] [pid 69404] AH01024: Command line: '/usr/local/path/httpd24/2.4.22_2/bin/httpd'
      - event.original: '[<timestamp/APACHE_ERROR>] [<_module>:<log.level>] [pid <process.pid>] <message>'
      # [Fri Jul 10 22:07:08.694043 1992] [core:error] [pid 69404:tid 9111016913] [client 11.12.13.14] File does not exist: /usr/local/path/someicon.ico
      - event.original: '[<timestamp/APACHE_ERROR>] [<_module>:<log.level>] [pid <process.pid>:tid <process.thread.id>] [client <source.address>] <message>'
      # [Fri Jul 10 22:07:08.694043 1992] [include:warn] [pid 69404] [client 120.121.122.123:12345] AH01024: some_include: Options +Includes (or IncludesNoExec) wasn't set, INCLUDES filter removed: /name.html
      - event.original: '[<timestamp/APACHE_ERROR>] [<_module>:<log.level>] [pid <process.pid>] [client <source.address>] <message>'
      # [Fri Jul 10 22:07:08 1992] [error] [client 192.191.190.1] File does not exist: /var/path/someicon.ico
      - event.original: '[<timestamp/APACHE_ERROR2>] [<log.level>] [client <source.ip>] <message>'
      # [Fri Jul 10 22:07:08 1992] [notice] Apache/2.2.22 (Ubuntu) configured -- resuming normal operations
      - event.original: '[<timestamp/APACHE_ERROR2>] [<log.level>] <message>'

normalize:
  - map:
     - event.kind: event
     - event.dataset: apache.error
     - event.category: +s_append/web
     - event.module: apache
     - service.type: apache
     - event.type: +s_append/info
  - check:
      - log.level: +r_match/^[eacw]
    map:
      - event.type: +s_append/error
