name: decoder_dbsync

parents:
  - json

check:
  - wazuh.queue: 53 # DBSYNC_MQ '5'

normalize:
  - check:
      - _json.type: +s_starts/integrity_check_
    map:
      _query: +s_concat/agent /$agent.id/ /$_json.component/ /$_json.type/ /$_json.data
      _query_response: +wdb_query/$_query
  - check:
      - _query_response: +exists
    map:
      _ar_query: +s_concat/(msg_to_agent) [] N!S /$agent.id/ /$_json.component/ dbsync /$_query_response/ /$_json.data
      _ar_result: +ar_write/$_ar_query

  - check:
      - _json.type: +s_eq/state
    map:
      _query: +s_concat/agent /$agent.id/ /$_json.component/ save2 /$_json.data
      _query_status: +wdb_update/$_query

  - check:
      - _json.type: +s_eq/integrity_clear
    map:
      _query: +s_concat/agent /$agent.id/ /$_json.component/ integrity_clear /$_json.data
      _query_status: +wdb_update/$_query
