name: decoder_dbsync

check:
  - queue: +i_eq/35

parse:
  logql:
    - event.original: <labels>

normalize:
  - map:
      event.original: $labels

  - check:
      - type: +s_starts/integrity_check_
    map:
      query: +s_concat/agent /$agent.id/ /$component/ /$type/ /$data_plain
      query_response: +wdb_query/$query
  - check:
      - query_response: +exists
    map:
      query_response.data.tail: +delete_field
      query_response.data.checksum: +delete_field
      ar_query: +s_concat/$component/ dbsync /$query_response/ /$data_plain
      ar_result: +ar_write/$ar_query

  - check:
      - type: +s_eq/state
    map:
      query: +s_concat/agent /$agent.id/ /$component/ save2 /$data_plain
      query_status: +wdb_update/$query

  - check:
      - type: +s_eq/integrity_clear
    map:
      query: +s_concat/agent /$agent.id/ /$component/ integrity_clear /$data_plain
      query_status: +wdb_update/$query
