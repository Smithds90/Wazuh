---
name: decoder/fim-event/0

parents:
  - decoder/fim/0

check:
  - _json.type: +s_eq/event
  - _json.data.path: +is_string
  - _json.data.type: +is_string

normalize:
  - map:
      - _do_save2: false

  - check:
      - _json.data.type: +s_eq/added
    map:
      - _do_save2: true
  - check:
      - _json.data.type: +s_eq/modified
    map:
      - _do_save2: true

  - check:
      - _do_save2: +is_true
    map:
      - _json.data.audit: +delete_field
      - _json.data.content_changes: +delete_field
      - _json.data.changed_attributes: +delete_field
      - _json.data.hard_links: +delete_field
      - _json.data.mode: +delete_field
      - _json.data.old_attributes: +delete_field
      - _json.data.type: +delete_field
      - _json.data.tags: +delete_field
      - _query: +s_concat/agent /$agent.id/ syscheck save2 /$_json.data
      - _query_result: +wdb_query/$_query

  - check:
      - _do_save2: +is_false
      - _json.data.type: +s_eq/deleted
    map:
      - _query: +s_concat/agent /$agent.id/ syscheck delete /$_json.data.path
      - _query_result: +wdb_query/$_query
