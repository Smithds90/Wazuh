name: decoder/rootcheck/0

check:
  - wazuh.queue: 57 # ROOTCHECK_MQ '9'

normalize:
  - map:
      - _time: +t_epoch
      - _query: +s_concat/agent /$agent.id/ rootcheck save /$_time/ /$event.original
      - _result: +wdb_query/$_query
      - wazuh.rootcheck.file: +r_ext/$event.original/(?:f|F)ile '(.*?)'
      - _title: "+r_ext/$event.original/(.*?)(?:(?: {)|$)"

  - check:
      - _result: "2"
    map:
      - wazuh.rootcheck.fts: true

  - check:
      - _result: "1"
    map:
      - wazuh.rootcheck.update: true

  - check:
      - wazuh.rootcheck.file: +not_exists
    map:
      - wazuh.rootcheck.file: "+r_ext/$event.original/File: (.*?)(?:(?:\\. )|(?:\\.$))"

  - map:
      - _title: "+r_ext/$_title/System Audit: (.*? - .*)"

  - map:
      - _title: "+r_ext/$_title/^(.*\\.) "

  - check:
      - _title: "+r_match/(?:f|F)ile "
    map:
      - _pre_file: "+r_ext/$_title/(.*?(?:f|F)ile) "
      - _pos_file: "+r_ext/$_title/(?:f|F)ile '(?:.*?)'(.*)"
      - _title: +s_concat/$_pre_file/$_pos_file

  - check:
      - _title: "+r_match/.+"
    map:
      - wazuh.rootcheck.title: +rename_field/$_title
