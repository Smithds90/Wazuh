name: suricata

parents:
  - json

metadata:
  description: This decoder is the parent decoder for the suricata decoders
  references:
    - https://suricata.io/documentation/
  product.name: suricata module
  product.versions:
    - v4.0.4

check:
  - _jsonEventOriginal.flow_id: +exists

normalize:
  - map:
      event.module: suricata

  - check:
      - _jsonEventOriginal.event_type: +r_match/^(?:alert|dns|flow|ftp|ftp_data|http|http2|mqtt|smb|ssh|stats|tftp|tls|rdp|rfb)$
    map:
      event.category: +s_append/network
      event.end: $_jsonEventOriginal.flow.end
      event.kind: event
      event.start: $_jsonEventOriginal.flow.start
      destination.address: $_jsonEventOriginal.dest_ip
      destination.bytes: $_jsonEventOriginal.flow.bytes_toclient
      destination.ip: $_jsonEventOriginal.dest_ip
      destination.mac: $_jsonEventOriginal.ether.dest_mac
      destination.packets: $_jsonEventOriginal.flow.pkts_toclient
      destination.port: $_jsonEventOriginal.dest_port
      file.path: $_jsonEventOriginal.fileinfo.filename
      file.size: $_jsonEventOriginal.fileinfo.size
      network.transport: $_jsonEventOriginal.proto
      source.address: $_jsonEventOriginal.src_ip
      source.bytes: $_jsonEventOriginal.flow.bytes_toserver
      source.ip: $_jsonEventOriginal.src_ip
      source.mac: $_jsonEventOriginal.ether.src_mac
      source.packets: $_jsonEventOriginal.flow.pkts_toserver
      source.port: $_jsonEventOriginal.src_port
      timestamp: $_jsonEventOriginal.timestamp
      network.protocol: $_jsonEventOriginal.app_proto

  - check:
      - network.protocol: http
    map:
      destination.domain: $_jsonEventOriginal.http.hostname
      event.category: +s_append/web
      event.type: +s_append/access/protocol
      http.request.method: $_jsonEventOriginal.http.http_method
      http.request.referrer: $_jsonEventOriginal.http.http_refer
      http.response.body.bytes: $_jsonEventOriginal.http.length
      http.response.status_code: $_jsonEventOriginal.http.status
      user_agent.original: $_jsonEventOriginal.http.http_user_agent
      url.domain: $_jsonEventOriginal.http.hostname
      url.original: $_jsonEventOriginal.http.url
      url.port: $_jsonEventOriginal.http.http_port
