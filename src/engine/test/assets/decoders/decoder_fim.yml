name: fim_event

check:
  - wazuh.queue: +i_eq/38
  - event.original.type: +exists
  - event.original.data: +exists
  - event.original.type: +s_eq/event
  - event.original.data.path: +exists
  - event.original.data.type: +exists

normalize:

  - check:
      event.original.data.type: +s_eq/added
    map:
      _do_save2: true
  - check:
      event.original.data.type: +s_eq/modified
    map:
      _do_save2: true

  - check:
      - _do_save2: +exists
    map:
      event.original.data.audit: +delete_field
      event.original.data.content_changes: +delete_field
      event.original.data.changed_attributes: +delete_field
      event.original.data.hard_links: +delete_field
      event.original.data.mode: +delete_field
      event.original.data.old_attributes: +delete_field
      event.original.data.type: +delete_field
      event.original.data.tags: +delete_field
      _query: +s_concat/agent /$agent.id/ syscheck save2 /$event.original.data
      _query_result: +wdb_query/$_query

  - check:
      - _do_save2: +not_exists
      - event.original.data.type: +s_eq/deleted
    map:
      _query: +s_concat/agent /$agent.id/ syscheck delete /$event.original.data.path
      _query_result: +wdb_query/$_query

---
name: fim_scan

check:
  - wazuh.queue: +i_eq/38
  - event.original.type: +exists
  - event.original.data: +exists
  - event.original.type: +s_neq/event
  - event.original.data.timestamp: +exists
  - event.original.data.timestamp: +is_number

normalize:

  - check:
      - event.original.type: +s_eq/scan_start
    map:
      _query: +s_concat/agent /$agent.id/ syscheck scan_info_update start_scan /$event.original.data.timestamp
      _query_result: +wdb_query/$_query

  - check:
      - event.original.type: +s_eq/scan_end
    map:
      _query: +s_concat/agent /$agent.id/ syscheck scan_info_update end_scan /$event.original.data.timestamp
      _query_result: +wdb_query/$_query
