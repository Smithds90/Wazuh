name: decoder_syscollector_port

parents:
  - decoder_syscollector_base

check:
  - event.original.type: +s_starts/port
  - event.original.ID: +exists

---

name: decoder_syscollector_port_save

parents:
  - decoder_syscollector_port

check:
  - event.original.port: +exist

normalize:
  - check:
      - event.original.timestamp: +not_exists
    map:
      event.original.timestamp: "NULL"

  - check:
      - event.original.port.protocol: +not_exists
    map:
      event.original.port.protocol: "NULL"

  - check:
      - event.original.port.local_ip: +not_exists
    map:
      event.original.port.local_ip: "NULL"

  - check:
      - event.original.port.local_port: +not_exists
    map:
      event.original.port.local_port: "NULL"

  - check:
      - event.original.port.remote_ip: +not_exists
    map:
      event.original.port.remote_ip: "NULL"

  - check:
      - event.original.port.remote_port: +not_exists
    map:
      event.original.port.remote_port: "NULL"

  - check:
      - event.original.port.tx_queue: +not_exists
    map:
      event.original.port.tx_queue: "NULL"

  - check:
      - event.original.port.rx_queue: +not_exists
    map:
      event.original.port.rx_queue: "NULL"

  - check:
      - event.original.port.inode: +not_exists
    map:
      event.original.port.inode: "NULL"

  - check:
      - event.original.port.state: +not_exists
    map:
      event.original.port.state: "NULL"

  - check:
      - event.original.port.PID: +not_exists
    map:
      event.original.port.PID: "NULL"

  - check:
      - event.original.port.process: +not_exists
    map:
      event.original.port.process: "NULL"

  - map:
    _query: +s_concat/agent /$event.original.agent.id /port save /$event.original.ID/|/$event.original.timestamp/|/$event.original.port.protocol/|/$event.original.port.local_ip/|/$event.original.port.local_port/|/$event.original.port.remote_ip/|/$event.original.port.remote_port/|/$event.original.port.tx_queue/|/$event.original.port.rx_queue/|/$event.original.port.inode/|/$event.original.port.state/|/$event.original.port.PID/|/$event.original.port.process
    _port_save_result: +wdb_update/$_query

---

name : decoder_syscollector_port_del

parents:
  - decoder_syscollector_port

check:
  - event.original.port: +not_exists
  - event.original.type: +s_eq/port_end

normalize:
  - map:
    _query: +s_concat/agent /$event.original.agent.id /port del /$event.original.ID
    _port_del_result: +wdb_update/$_query
