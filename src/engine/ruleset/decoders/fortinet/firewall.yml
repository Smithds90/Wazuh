---
name: decoder/fortinet-firewall/0

metadata:
  title: Decoder for parsing fortinet firewall logs
  description: Decoder for parsing fortinet firewall logs
  compatibility: >
    This decoder has been tested on Wazuh version 4.3
  author:
    name: Wazuh, Inc.
    date: 2023/01/10
  references:
    - https://docs.fortinet.com/document/forticlient/7.0.2/log-message-reference/327109

sources:
    - decoder/queue-localfile/0

check:
- event.original: +s_starts/<

parse:
  logpar:
    # Parsers for firewall event
    #
    # <189>date=2020-04-23 time=12:32:48 devname="testswitch3" devid="someotherrouteridagain" logid="0102043014" type="event" subtype="user" level="notice" vd="root" eventtime=1587231168439640874 tz="-0500" logdesc="FSSO logon authentication status" srcip=10.10.10.10 user="elasticouser" server="elasticserver" action="FSSO-logon" msg="FSSO-logon event from FSSO_elasticserver: user elasticouser logged on 10.10.10.10"
    - event.original: <~/literal/<189>>date=<~tmp.date> time=<~tmp.time> devname="<observer.name>" devid="<observer.serial_number>" logid="<event.code>" type="<event.kind>" subtype="<~tmp.fortinet.firewall.subtype>" level="<log.level>" vd="<~tmp.fortinet.firewall.vd>" eventtime=<~> tz="<~tmp.tz>" logdesc="<rule.description>" srcip=<source.ip> user="<source.user.name>" server="<~tmp.fortinet.firewall.server>" action="<event.action>" msg="<message>"
    # <189>date=2020-04-23 time=12:32:09 devname="testswitch3" devid="someotherrouteridagain" logid="0102043039" type="event" subtype="user" level="notice" vd="root" eventtime=1587231130109462858 tz="-0500" logdesc="Authentication logon" srcip=10.10.10.10 user="elastiiiuser" authserver="FSSO_elastiauth" action="auth-logon" status="logon" msg="User elastiiiuser added to auth logon"
    - event.original: <~/literal/<189>>date=<~tmp.date> time=<~tmp.time> devname="<observer.name>" devid="<observer.serial_number>" logid="<event.code>" type="<event.kind>" subtype="<~tmp.fortinet.firewall.subtype>" level="<log.level>" vd="<~tmp.fortinet.firewall.vd>" eventtime=<~> tz="<~tmp.tz>" logdesc="<rule.description>" srcip=<source.ip> user="<source.user.name>" authserver="<~tmp.fortinet.firewall.authserver>" action="<event.action>" status="<~tmp.fortinet.firewall.status>" msg="<message>"
    # <190>date=2019-05-13 time=15:55:56 logid="0102043008" type="event" subtype="user" level="notice" vd="root" eventtime=1557788156913809277 logdesc="Authentication success" srcip=10.1.100.11 dstip=172.16.200.55 policyid=1 interface="port10" user="bob" group="local-group1" authproto="TELNET(10.1.100.11)" action="authentication" status="success" reason="N/A" msg="User bob succeeded in authentication"
    - event.original: <~/literal/<190>>date=<~tmp.date> time=<~tmp.time> logid="<event.code>" type="<event.kind>" subtype="<~tmp.fortinet.firewall.subtype>" level="<log.level>" vd="<~tmp.fortinet.firewall.vd>" eventtime=<~> logdesc="<rule.description>" srcip=<source.ip> dstip=<destination.ip> policyid=<rule.id> interface="<~tmp.fortinet.firewall.interface>" user="<source.user.name>" group="<source.user.group.name>" authproto="<~tmp.fortinet.firewall.authproto>" action="<event.action>" status="<~tmp.fortinet.firewall.status>" reason="<~>" msg="<message>"
    # <189>date=2020-04-23 time=14:32:09 devname="testswitch3" devid="someotherrouteridagain" logid="0100040704" type="event" subtype="system" level="notice" vd="root" eventtime=1587231129938795255 tz="-0300" logdesc="System performance statistics" action="perf-stats" cpu=0 mem=10 totalsession=23 disk=0 bandwidth="23/4" setuprate=0 disklograte=0 fazlograte=0 freediskstorage=331 sysuptime=25170 msg="Performance statistics: average CPU: 0, memory:  23, concurrent sessions:  20, setup-rate: 0"
    - event.original: <~/literal/<189>>date=<~tmp.date> time=<~tmp.time> devname="<observer.name>" devid="<observer.serial_number>" logid="<event.code>" type="<event.kind>" subtype="<~tmp.fortinet.firewall.subtype>" level="<log.level>" vd="<~tmp.fortinet.firewall.vd>" eventtime=<~> tz="<~tmp.tz>" logdesc="<rule.description>" action="<event.action>" cpu=<~tmp.fortinet.firewall.cpu> mem=<~tmp.fortinet.firewall.mem> totalsession=<~tmp.fortinet.firewall.totalsession> disk=<~tmp.fortinet.firewall.disk> bandwidth="<~tmp.fortinet.firewall.bandwidth>" setuprate=<~tmp.fortinet.firewall.setuprate> disklograte=<~tmp.fortinet.firewall.disklograte> fazlograte=<~tmp.fortinet.firewall.fazlograte> freediskstorage=<~tmp.fortinet.firewall.freediskstorage> sysuptime=<~tmp.fortinet.firewall.sysuptime> msg="<message>"
    # <187>date=2020-04-23 time=12:32:47 devname="testswitch3" devid="someotherrouteridagain" logid="0101037124" type="event" subtype="vpn" level="error" vd="root" eventtime=1587231168339114138 tz="-0500" logdesc="IPsec phase 1 error" msg="IPsec phase 1 error" action="negotiate" remip=8.8.4.4 locip=175.16.199.1 remport=500 locport=500 outintf="wan2" cookies="345hkjhdrs87/0000000000000000" user="N/A" group="N/A" xauthuser="N/A" xauthgroup="N/A" assignip=N/A vpntunnel="N/A" status="negotiate_error" reason="peer SA proposal not match local policy" peer_notif="NOT-APPLICABLE"
    - event.original: <~/literal/<187>>date=<~tmp.date> time=<~tmp.time> devname="<observer.name>" devid="<observer.serial_number>" logid="<event.code>" type="<event.kind>" subtype="<~tmp.fortinet.firewall.subtype>" level="<log.level>" vd="<~tmp.fortinet.firewall.vd>" eventtime=<~> tz="<~tmp.tz>" logdesc="<rule.description>" msg="<message>" action="<event.action>" remip=<destination.ip> locip=<source.ip> remport=<destination.port> locport=<source.port> outintf="<~tmp.fortinet.firewall.outintf>" cookies="<~tmp.fortinet.firewall.cookies>" user="<~>" group="<~>" xauthuser="<~>" xauthgroup="<~>" assignip=<~> vpntunnel="<~>" status="<~tmp.fortinet.firewall.status>" reason="<event.reason>" peer_notif="<~tmp.fortinet.firewall.peer_notif>"
    # <189>date=2020-04-23 time=12:32:31 devname="testswitch3" devid="someotherrouteridagain" logid="0101037127" type="event" subtype="vpn" level="notice" vd="root" eventtime=1587231151628960857 tz="-0500" logdesc="Progress IPsec phase 1" msg="progress IPsec phase 1" action="negotiate" remip=8.4.5.4 locip=1.128.3.4 remport=500 locport=500 outintf="wan1" cookies="df868dsg876d/0000000000000000" user="N/A" group="N/A" xauthuser="N/A" xauthgroup="N/A" assignip=N/A vpntunnel="elasticvpn" status="success" init="local" mode="main" dir="outbound" stage=1 role="initiator" result="OK"
    - event.original: <~tmp.type>date=<~tmp.date> time=<~tmp.time> devname="<observer.name>" devid="<observer.serial_number>" logid="<event.code>" type="<event.kind>" subtype="<~tmp.fortinet.firewall.subtype>" level="<log.level>" vd="<~tmp.fortinet.firewall.vd>" eventtime=<~> tz="<~tmp.tz>" logdesc="<rule.description>" msg="<message>" action="<event.action>" remip=<destination.ip> locip=<source.ip> remport=<destination.port> locport=<source.port> outintf="<~tmp.fortinet.firewall.outintf>" cookies="<~tmp.fortinet.firewall.cookies>" user="<~>" group="<~>" xauthuser="<~>" xauthgroup="<~>" assignip=<~> vpntunnel="<~tmp.fortinet.firewall.vpntunnel>" status="<~tmp.fortinet.firewall.status>" init="<~tmp.fortinet.firewall.init>" mode="<~tmp.fortinet.firewall.mode>" dir="<~tmp.dir>" stage=<~tmp.fortinet.firewall.stage> role="<~tmp.fortinet.firewall.role>" result="<~tmp.fortinet.firewall.result>"
    # <190>date=2020-11-02 time=08:11:38 devname=testfirewall devid=newrouterid logid=0101037127 type="event" subtype=vpn level=notice vd=root logdesc="Progress IPsec phase 1" msg="progress IPsec phase 1" action=negotiate remip=175.16.199.1 locip=10.10.10.10 remport=500 locport=500 outintf="port1" cookies="125cbf9ee8349965/0000000000000000" user="N/A" group="N/A" xauthuser="N/A" xauthgroup="N/A" assignip=N/A vpntunnel="P1_Test" status=success init=local mode=aggressive dir=outbound stage=1 role=initiator result=OK
    - event.original: <~tmp.type>date=<~tmp.date> time=<~tmp.time> devname=<observer.name> devid=<observer.serial_number> logid=<event.code> type="<event.kind>" subtype=<~tmp.fortinet.firewall.subtype> level=<log.level> vd=<~tmp.fortinet.firewall.vd> logdesc="<rule.description>" msg="<message>" action=<event.action> remip=<destination.ip> locip=<source.ip> remport=<destination.port> locport=<source.port> outintf="<~tmp.fortinet.firewall.outintf>" cookies="<~tmp.fortinet.firewall.cookies>" user="<~>" group="<~>" xauthuser="<~>" xauthgroup="<~>" assignip=<~> vpntunnel="<~tmp.fortinet.firewall.vpntunnel>" status=<~tmp.fortinet.firewall.status> init=<~tmp.fortinet.firewall.init> mode=<~tmp.fortinet.firewall.mode> dir=<~tmp.dir> stage=<~tmp.fortinet.firewall.stage> role=<~tmp.fortinet.firewall.role> result=<~tmp.fortinet.firewall.result>
    # <190>date=2019-05-13 time=14:21:42 logid="0101037127" type="event" subtype="vpn" level="notice" vd="root" eventtime=1557782502722231889 logdesc="Progress IPsec phase 1" msg="progress IPsec phase 1" action="negotiate" remip=50.1.1.101 locip=1.128.3.4 remport=500 locport=500 outintf="port14" cookies="9091f4d4837ea71c/0000000000000000" user="N/A" group="N/A" xauthuser="N/A" xauthgroup="N/A" assignip=N/A vpntunnel="test" status="success" init="local" mode="main" dir="outbound" stage=1 role="initiator" result="OK"
    - event.original: <~tmp.type>date=<~tmp.date> time=<~tmp.time> logid="<event.code>" type="<event.kind>" subtype="<~tmp.fortinet.firewall.subtype>" level="<log.level>" vd="<~tmp.fortinet.firewall.vd>" eventtime=<~> logdesc="<rule.description>" msg="<message>" action="<event.action>" remip=<destination.ip> locip=<source.ip> remport=<destination.port> locport=<source.port> outintf="<~tmp.fortinet.firewall.outintf>" cookies="<~tmp.fortinet.firewall.cookies>" user="<~>" group="<~>" xauthuser="<~>" xauthgroup="<~>" assignip=<~> vpntunnel="<~tmp.fortinet.firewall.vpntunnel>" status="<~tmp.fortinet.firewall.status>" init="<~tmp.fortinet.firewall.init>" mode="<~tmp.fortinet.firewall.mode>" dir="<~tmp.dir>" stage=<~tmp.fortinet.firewall.stage> role="<~tmp.fortinet.firewall.role>" result="<~tmp.fortinet.firewall.result>"
    # <189>date=2020-04-23 time=14:24:13 devname="testswitch3" devid="someotherrouteridagain" logid="0100041006" type="event" subtype="system" level="notice" vd="root" eventtime=1587230655301863513 tz="-0300" logdesc="FortiSandbox AV database updated" version="1.522479" msg="FortiSandbox AV database updated"
    - event.original: <~tmp.type>date=<~tmp.date> time=<~tmp.time> devname="<observer.name>" devid="<observer.serial_number>" logid="<event.code>" type="<event.kind>" subtype="<~tmp.fortinet.firewall.subtype>" level="<log.level>" vd="<~tmp.fortinet.firewall.vd>" eventtime=<~> tz="<~tmp.tz>" logdesc="<rule.description>" version="<~tmp.fortinet.firewall.version>" msg="<message>"
    # <190>date=2020-04-23 time=12:23:47 devname="testswitch3" devid="someotherrouteridagain" logid="0107045057" type="event" subtype="endpoint" level="information" vd="root" eventtime=1587230627558979735 tz="-0500" logdesc="FortiClient connection added" action="add" status="success" license_limit="unlimited" used_for_type=3 connection_type="sslvpn" count=2 user="elastico" ip=172.16.0.2 name="somerouter" fctuid="645234fdd01F885824F764" msg="Add a FortiClient Connection."
    - event.original: <~tmp.type>date=<~tmp.date> time=<~tmp.time> devname="<observer.name>" devid="<observer.serial_number>" logid="<event.code>" type="<event.kind>" subtype="<~tmp.fortinet.firewall.subtype>" level="<log.level>" vd="<~tmp.fortinet.firewall.vd>" eventtime=<~> tz="<~tmp.tz>" logdesc="<rule.description>" action="<event.action>" status="<~tmp.fortinet.firewall.status>" license_limit="<~tmp.fortinet.firewall.license_limit>" used_for_type=<~tmp.fortinet.firewall.used_for_type> connection_type="<~tmp.fortinet.firewall.connection_type>" count=<~tmp.fortinet.firewall.count> user="<source.user.name>" ip=<~tmp.fortinet.firewall.ip> name="<~tmp.fortinet.firewall.name>" fctuid="<~tmp.fortinet.firewall.fctuid>" msg="<message>"
    # <190>date=2020-04-23 time=12:23:47 devname="testswitch3" devid="someotherrouteridagain" logid="0101039943" type="event" subtype="vpn" level="information" vd="root" eventtime=1587230627334405765 tz="-0500" logdesc="SSL VPN new connection" action="ssl-new-con" tunneltype="ssl" tunnelid=2 remip=8.8.8.6 user="N/A" group="N/A" dst_host="N/A" reason="N/A" msg="SSL new connection"
    - event.original: <~tmp.type>date=<~tmp.date> time=<~tmp.time> devname="<observer.name>" devid="<observer.serial_number>" logid="<event.code>" type="<event.kind>" subtype="<~tmp.fortinet.firewall.subtype>" level="<log.level>" vd="<~tmp.fortinet.firewall.vd>" eventtime=<~> tz="<~tmp.tz>" logdesc="<rule.description>" action="<event.action>" tunneltype="<~tmp.fortinet.firewall.tunneltype>" tunnelid=<~tmp.fortinet.firewall.tunnelid> remip=<destination.ip> user="<~>" group="<~>" dst_host="<~>" reason="<~>" msg="<message>"
    # <190>date=2020-04-23 time=12:23:47 devname="testswitch3" devid="someotherrouteridagain" logid="0101039947" type="event" subtype="vpn" level="information" vd="root" eventtime=1587230627698970007 tz="-0500" logdesc="SSL VPN tunnel up" action="tunnel-up" tunneltype="ssl-tunnel" tunnelid=2345 remip=8.8.5.4 tunnelip=10.10.10.10 user="someuser" group="somegroup" dst_host="N/A" reason="tunnel established" msg="SSL tunnel established"
    - event.original: <~tmp.type>date=<~tmp.date> time=<~tmp.time> devname="<observer.name>" devid="<observer.serial_number>" logid="<event.code>" type="<event.kind>" subtype="<~tmp.fortinet.firewall.subtype>" level="<log.level>" vd="<~tmp.fortinet.firewall.vd>" eventtime=<~> tz="<~tmp.tz>" logdesc="<rule.description>" action="<event.action>" tunneltype="<~tmp.fortinet.firewall.tunneltype>" tunnelid=<~tmp.fortinet.firewall.tunnelid> remip=<destination.ip> tunnelip=<~tmp.fortinet.firewall.tunnelip> user="<source.user.name>" group="<source.user.group.name>" dst_host="<~>" reason="<event.reason>" msg="<message>"
    # <189>date=2020-04-23 time=12:16:02 devname="testswitch3" devid="someotherrouteridagain" logid="0100022913" type="event" subtype="system" level="notice" vd="root" eventtime=1587230163375149856 tz="-0500" logdesc="FortiCloud server disconnected" server="4.4.4.4" action="disconnect" reason="connection reset" msg="FortiCloud 4.4.4.4 server is disconnected"
    - event.original: <~tmp.type>date=<~tmp.date> time=<~tmp.time> devname="<observer.name>" devid="<observer.serial_number>" logid="<event.code>" type="<event.kind>" subtype="<~tmp.fortinet.firewall.subtype>" level="<log.level>" vd="<~tmp.fortinet.firewall.vd>" eventtime=<~> tz="<~tmp.tz>" logdesc="<rule.description>" server="<~tmp.fortinet.firewall.server>" action="<event.action>" reason="<event.reason>" msg="<message>"
    # <189>date=2020-04-23 time=12:16:02 devname="testswitch3" devid="someotherrouteridagain" logid="0100022915" type="event" subtype="system" level="notice" vd="root" eventtime=1587230163121116383 tz="-0500" logdesc="FortiCloud server connected" server="1.128.3.4" action="connect" msg="FortiCloud 1.128.3.4 server is connected"
    - event.original: <~tmp.type>date=<~tmp.date> time=<~tmp.time> devname="<observer.name>" devid="<observer.serial_number>" logid="<event.code>" type="<event.kind>" subtype="<~tmp.fortinet.firewall.subtype>" level="<log.level>" vd="<~tmp.fortinet.firewall.vd>" eventtime=<~> tz="<~tmp.tz>" logdesc="<rule.description>" server="<~tmp.fortinet.firewall.server>" action="<event.action>" msg="<message>"
    # <190>date=2019-05-13 time=11:20:54 logid="0100032001" type="event" subtype="system" level="information" vd="vdom1" eventtime=1557771654587081441 logdesc="Admin login successful" sn="1557771654" user="admin" ui="ssh(172.16.200.254)" method="ssh" srcip=172.16.200.254 dstip=172.16.200.2 action="login" status="success" reason="none" profile="super_admin" msg="Administrator admin logged in successfully from ssh(172.16.200.254)"
    - event.original: <~tmp.type>date=<~tmp.date> time=<~tmp.time> logid="<event.code>" type="<event.kind>" subtype="<~tmp.fortinet.firewall.subtype>" level="<log.level>" vd="<~tmp.fortinet.firewall.vd>" eventtime=<~> logdesc="<rule.description>" sn="<~tmp.fortinet.firewall.sn>" user="<source.user.name>" ui="<~tmp.fortinet.firewall.ui>" method="<~tmp.fortinet.firewall.method>" srcip=<source.ip> dstip=<destination.ip> action="<event.action>" status="<~tmp.fortinet.firewall.status>" reason="<event.reason>" profile="<~tmp.fortinet.firewall.profile>" msg="<message>"
    # <189>date=2019-05-14 time=08:32:13 logid="0107045057" type="event" subtype="endpoint" level="information" vd="root" eventtime=1557847933900764210 logdesc="FortiClient connection added" action="add" status="success" license_limit="unlimited" used_for_type=4 connection_type="sslvpn" count=1 user="skubas" ip=172.18.64.250 name="VAN-200957-PC" fctuid="52C66FE08F724FE0B116DAD5062C96CD" msg="Add a FortiClient Connection."
    - event.original: <~tmp.type>date=<~tmp.date> time=<~tmp.time> logid="<event.code>" type="<event.kind>" subtype="<~tmp.fortinet.firewall.subtype>" level="<log.level>" vd="<~tmp.fortinet.firewall.vd>" eventtime=<~> logdesc="<rule.description>" action="<event.action>" status="<~tmp.fortinet.firewall.status>" license_limit="<~tmp.fortinet.firewall.license_limit>" used_for_type=<~tmp.fortinet.firewall.used_for_type> connection_type="<~tmp.fortinet.firewall.connection_type>" count=<~tmp.fortinet.firewall.count> user="<source.user.name>" ip=<~tmp.fortinet.firewall.ip> name="<~tmp.fortinet.firewall.name>" fctuid="<~tmp.fortinet.firewall.fctuid>" msg="<message>"
    # <190>devname="firewall" devid="FG201EEF34CD12AB" vd="root" date=2021-05-07 time=08:31:14 eventtime=1620372674880370858 tz="+0100" logid="0112053203" type="event" subtype="connector" level="information" logdesc="Dynamic address updated" fctemssn="FCTEMS0000011111" addr="FCTEMS0000011111_AV-Running" msg="Updated tag FCTEMS0000011111_AV-Running."
    - event.original: <~tmp.type>devname="<observer.name>" devid="<observer.serial_number>" vd="<~tmp.fortinet.firewall.vd>" date=<~tmp.date> time=<~tmp.time> eventtime=<~> tz="<~tmp.tz>" logid="<event.code>" type="<event.kind>" subtype="<~tmp.fortinet.firewall.subtype>" level="<log.level>" logdesc="<rule.description>" fctemssn="<~tmp.fortinet.firewall.fctemssn>" addr="<~tmp.fortinet.firewall.addrgrp>" msg="<message>"
    #
    # Parsers for firewall traffic
    #
    # <189>date=2020-04-23 time=01:16:08 devname="testswitch1" devid="somerouterid" logid="0000000013" type="traffic" subtype="forward" level="notice" vd="OPERATIONAL" eventtime=1592961368 srcip=10.10.10.10 srcport=60899 srcintf="srcintfname" srcintfrole="lan" dstip=175.16.199.1 dstport=161 dstintf="dstintfname" dstintfrole="lan" sessionid=155313 proto=17 action="deny" policyid=0 policytype="policy" service="SNMP" dstcountry="Reserved" srccountry="Reserved" trandisp="noop" duration=0 sentbyte=0 rcvdbyte=0 sentpkt=0 appcat="unscanned" crscore=30 craction=131072 crlevel="high"
    - event.original: <~tmp.type>date=<~tmp.date> time=<~tmp.time> devname="<observer.name>" devid="<observer.serial_number>" logid="<event.code>" type="<~tmp.fortinet.firewall.type>" subtype="<~tmp.fortinet.firewall.subtype>" level="<log.level>" vd="<~tmp.fortinet.firewall.vd>" eventtime=<~> srcip=<source.ip> srcport=<source.port> srcintf="<observer.ingress.interface.name>" srcintfrole="<~tmp.fortinet.firewall.srcintfrole>" dstip=<destination.ip> dstport=<destination.port> dstintf="<observer.egress.interface.name>" dstintfrole="<~tmp.fortinet.firewall.dstintfrole>" sessionid=<~tmp.fortinet.firewall.sessionid> proto=<network.iana_number> action="<event.action>" policyid=<rule.id> policytype="<rule.ruleset>" service="<network.protocol>" dstcountry="<~tmp.fortinet.firewall.dstcountry>" srccountry="<~tmp.fortinet.firewall.srccountry>" trandisp="<~tmp.fortinet.firewall.trandisp>" duration=<event.duration> sentbyte=<source.bytes> rcvdbyte=<destination.bytes> sentpkt=<source.packets> appcat="<rule.category>" crscore=<~tmp.fortinet.firewall.crscore> craction=<~tmp.fortinet.firewall.craction> crlevel="<~tmp.fortinet.firewall.crlevel>"
    # <188>date=2020-04-23 time=12:14:39 devname="firewall3" devid="oldfwid" logid="0000000011" type="traffic" subtype="forward" level="warning" vd="root" eventtime=1587230079841464445 tz="-0500" srcip=192.168.1.1 srcport=62493 srcintf="port1" srcintfrole="lan" dstip=192.168.100.100 dstport=1235 dstintf="newinterface" dstintfrole="undefined" sessionid=54234 proto=17 action="ip-conn" policyid=49 policytype="policy" poluuid="654cc-b6542-53467u8-e45234-1566casd35f7836" policyname="oldpolicyname" user="elasticsuper" authserver="FSSO_newfsso" service="udp/12302" dstcountry="Reserved" srccountry="Reserved" appcat="unscanned" crscore=5 craction=63332144 crlevel="low"
    - event.original: <~tmp.type>date=<~tmp.date> time=<~tmp.time> devname="<observer.name>" devid="<observer.serial_number>" logid="<event.code>" type="<~tmp.fortinet.firewall.type>" subtype="<~tmp.fortinet.firewall.subtype>" level="<log.level>" vd="<~tmp.fortinet.firewall.vd>" eventtime=<~> tz="<~tmp.tz>" srcip=<source.ip> srcport=<source.port> srcintf="<observer.ingress.interface.name>" srcintfrole="<~tmp.fortinet.firewall.srcintfrole>" dstip=<destination.ip> dstport=<destination.port> dstintf="<observer.egress.interface.name>" dstintfrole="<~tmp.fortinet.firewall.dstintfrole>" sessionid=<~tmp.fortinet.firewall.sessionid> proto=<network.iana_number> action="<event.action>" policyid=<rule.id> policytype="<rule.ruleset>" poluuid="<rule.uuid>" policyname="<rule.name>" user="<source.user.name>" authserver="<~tmp.fortinet.firewall.authserver>" service="<network.protocol>" dstcountry="<~tmp.fortinet.firewall.dstcountry>" srccountry="<~tmp.fortinet.firewall.srccountry>" appcat="<rule.category>" crscore=<~tmp.fortinet.firewall.crscore> craction=<~tmp.fortinet.firewall.craction> crlevel="<~tmp.fortinet.firewall.crlevel>"
    # <189>date=2019-03-31 time=06:42:54 logid="0002000012" type="traffic" subtype="multicast" level="notice" vd="vdom1" eventtime=1554039772 srcip=172.16.200.55 srcport=60660 srcintf="port25" srcintfrole="undefined" dstip=230.1.1.2 dstport=7878 dstintf="port3" dstintfrole="undefined" sessionid=1162 proto=17 action="accept" policyid=1 policytype="multicast-policy" service="udp/7878" dstcountry="Reserved" srccountry="Reserved" trandisp="noop" duration=22 sentbyte=5940 rcvdbyte=0 sentpkt=11 rcvdpkt=0 appcat="unscanned"
    - event.original: <~tmp.type>date=<~tmp.date> time=<~tmp.time> logid="<event.code>" type="<~tmp.fortinet.firewall.type>" subtype="<~tmp.fortinet.firewall.subtype>" level="<log.level>" vd="<~tmp.fortinet.firewall.vd>" eventtime=<~> srcip=<source.ip> srcport=<source.port> srcintf="<observer.ingress.interface.name>" srcintfrole="<~tmp.fortinet.firewall.srcintfrole>" dstip=<destination.ip> dstport=<destination.port> dstintf="<observer.egress.interface.name>" dstintfrole="<~tmp.fortinet.firewall.dstintfrole>" sessionid=<~tmp.fortinet.firewall.sessionid> proto=<network.iana_number> action="<event.action>" policyid=<rule.id> policytype="<rule.ruleset>" service="<network.protocol>" dstcountry="<~tmp.fortinet.firewall.dstcountry>" srccountry="<~tmp.fortinet.firewall.srccountry>" trandisp="<~tmp.fortinet.firewall.trandisp>" duration=<event.duration> sentbyte=<source.bytes> rcvdbyte=<destination.bytes> sentpkt=<source.packets> rcvdpkt=<destination.packets> appcat="<rule.category>"
    # <189>date=2019-05-10 time=14:18:54 logid="0004000017" type="traffic" subtype="sniffer" level="notice" vd="root" eventtime=1557523134021045897 srcip=67.43.156.15 srcport=50463 srcintf="port1" srcintfrole="undefined" dstip=104.80.88.154 dstport=443 dstintf="port1" dstintfrole="undefined" sessionid=2193276 proto=6 action="accept" policyid=3 policytype="sniffer" service="HTTPS" dstcountry="United States" srccountry="Canada" trandisp="snat" transip=0.0.0.0 transport=0 duration=10 sentbyte=0 rcvdbyte=0 sentpkt=0 rcvdpkt=0 appcat="unscanned" utmaction="allow" countips=1 crscore=5 craction=32768 sentdelta=0 rcvddelta=0 utmref=65162-7772
    - event.original: <~tmp.type>date=<~tmp.date> time=<~tmp.time> logid="<event.code>" type="<~tmp.fortinet.firewall.type>" subtype="<~tmp.fortinet.firewall.subtype>" level="<log.level>" vd="<~tmp.fortinet.firewall.vd>" eventtime=<~> srcip=<source.ip> srcport=<source.port> srcintf="<observer.ingress.interface.name>" srcintfrole="<~tmp.fortinet.firewall.srcintfrole>" dstip=<destination.ip> dstport=<destination.port> dstintf="<observer.egress.interface.name>" dstintfrole="<~tmp.fortinet.firewall.dstintfrole>" sessionid=<~tmp.fortinet.firewall.sessionid> proto=<network.iana_number> action="<event.action>" policyid=<rule.id> policytype="<rule.ruleset>" service="<network.protocol>" dstcountry="<~tmp.fortinet.firewall.dstcountry>" srccountry="<~tmp.fortinet.firewall.srccountry>" trandisp="<~tmp.fortinet.firewall.trandisp>" transip=<source.nat.ip> transport=<source.nat.port> duration=<event.duration> sentbyte=<source.bytes> rcvdbyte=<destination.bytes> sentpkt=<source.packets> rcvdpkt=<destination.packets> appcat="<rule.category>" utmaction="<~tmp.fortinet.firewall.utmaction>" countips=<~tmp.fortinet.firewall.countips> crscore=<~tmp.fortinet.firewall.crscore> craction=<~tmp.fortinet.firewall.craction> sentdelta=<~tmp.fortinet.firewall.sentdelta> rcvddelta=<~tmp.fortinet.firewall.rcvddelta> utmref=<~tmp.fortinet.firewall.utmref>

    # <189>date=2020-04-23 time=12:14:28 devname="firewall3" devid="oldfwid" logid="0000000013" type="traffic" subtype="forward" level="notice" vd="root" eventtime=1587230069291463928 tz="-0500" srcip=81.2.69.145 srcport=56603 srcintf="port1" srcintfrole="lan" dstip=175.16.199.1 dstport=442 dstintf="wan1" dstintfrole="wan" sessionid=2345 proto=6 action="close" policyid=2365 policytype="policy" poluuid="654644c-b064-fdgdf3425-f003-1234ghdf682e05f" policyname="someoldpolicyname" user="elasticuser" group="testgroup" authserver="FSSO_something" service="HTTPS" dstcountry="Netherlands" srccountry="Reserved" trandisp="snat" transip=23.23.23.23 transport=603 appid=43540 app="Skype.Portals" appcat="Collaboration" apprisk="elevated" applist="someapplist" appact="detected" duration=126 sentbyte=923 rcvdbyte=77654 sentpkt=113 rcvdpkt=70 vwlid=4 vwlquality="Seq_num(3), alive, selected" wanin=1130 wanout=6671 lanin=1406 lanout=146506 utmaction="block" countweb=1 countapp=1 crscore=5 craction=6144 crlevel="low"
    - event.original: <~tmp.type>date=<~tmp.date> time=<~tmp.time> devname="<observer.name>" devid="<observer.serial_number>" logid="<event.code>" type="<~tmp.fortinet.firewall.type>" subtype="<~tmp.fortinet.firewall.subtype>" level="<log.level>" vd="<~tmp.fortinet.firewall.vd>" eventtime=<~> tz="<~tmp.tz>" srcip=<source.ip> srcport=<source.port> srcintf="<observer.ingress.interface.name>" srcintfrole="<~tmp.fortinet.firewall.srcintfrole>" dstip=<destination.ip> dstport=<destination.port> dstintf="<observer.egress.interface.name>" dstintfrole="<~tmp.fortinet.firewall.dstintfrole>" sessionid=<~tmp.fortinet.firewall.sessionid> proto=<network.iana_number> action="<event.action>" policyid=<rule.id> policytype="<rule.ruleset>" poluuid="<rule.uuid>" policyname="<rule.name>" user="<source.user.name>" group="<source.user.group.name>" authserver="<~tmp.fortinet.firewall.authserver>" service="<network.protocol>" dstcountry="<~tmp.fortinet.firewall.dstcountry>" srccountry="<~tmp.fortinet.firewall.srccountry>" trandisp="<~tmp.fortinet.firewall.trandisp>" transip=<source.nat.ip> transport=<source.nat.port> appid=<~tmp.fortinet.firewall.appid> app="<network.application>" appcat="<rule.category>" apprisk="<~tmp.fortinet.firewall.apprisk>" applist="<~tmp.fortinet.firewall.applist>" appact="<~tmp.fortinet.firewall.appact>" duration=<event.duration> sentbyte=<source.bytes> rcvdbyte=<destination.bytes> sentpkt=<source.packets> rcvdpkt=<destination.packets> vwlid=<~tmp.fortinet.firewall.vwlid> vwlquality="<~tmp.fortinet.firewall.vwlquality>" wanin=<~tmp.fortinet.firewall.wanin> wanout=<~tmp.fortinet.firewall.wanout> lanin=<~tmp.fortinet.firewall.lanin> lanout=<~tmp.fortinet.firewall.lanout> utmaction="<~tmp.fortinet.firewall.utmaction>" countweb=<~tmp.fortinet.firewall.countweb> countapp=<~tmp.fortinet.firewall.countapp> crscore=<~tmp.fortinet.firewall.crscore> craction=<~tmp.fortinet.firewall.craction> crlevel="<~tmp.fortinet.firewall.crlevel>"
    # <188>date=2020-04-23 time=12:14:09 devname="newfirewall" devid="newrouterid" logid="0000000011" type="traffic" subtype="forward" level="warning" vd="root" eventtime=1587230049761513222 tz="-0500" srcip=192.168.1.6 srcport=53438 srcintf="port1" srcintfrole="lan" dstip=175.16.199.1 dstport=53 dstintf="wan1" dstintfrole="wan" sessionid=435234 proto=17 action="dns" policyid=26 policytype="policy" poluuid="2345de-b143-52134d8-6654f-4654sdfg16f431" policyname="elasticnewruleset" service="DNS" dstcountry="Netherlands" srccountry="Reserved" appcat="unscanned" crscore=5 craction=54144 crlevel="low"
    - event.original: <~tmp.type>date=<~tmp.date> time=<~tmp.time> devname="<observer.name>" devid="<observer.serial_number>" logid="<event.code>" type="<~tmp.fortinet.firewall.type>" subtype="<~tmp.fortinet.firewall.subtype>" level="<log.level>" vd="<~tmp.fortinet.firewall.vd>" eventtime=<~> tz="<~tmp.tz>" srcip=<source.ip> srcport=<source.port> srcintf="<observer.ingress.interface.name>" srcintfrole="<~tmp.fortinet.firewall.srcintfrole>" dstip=<destination.ip> dstport=<destination.port> dstintf="<observer.egress.interface.name>" dstintfrole="<~tmp.fortinet.firewall.dstintfrole>" sessionid=<~tmp.fortinet.firewall.sessionid> proto=<network.iana_number> action="<event.action>" policyid=<rule.id> policytype="<rule.ruleset>" poluuid="<rule.uuid>" policyname="<rule.name>" service="<network.protocol>" dstcountry="<~tmp.fortinet.firewall.dstcountry>" srccountry="<~tmp.fortinet.firewall.srccountry>" appcat="<rule.category>" crscore=<~tmp.fortinet.firewall.crscore> craction=<~tmp.fortinet.firewall.craction> crlevel="<~tmp.fortinet.firewall.crlevel>"
    # <189>date=2020-04-23 time=12:11:51 devname="newfirewall" devid="newrouterid" logid="0000000020" type="traffic" subtype="forward" level="notice" vd="root" eventtime=1587229911390385486 tz="-0500" srcip=175.16.199.1 srcport=6000 srcintf="port1" srcintfrole="lan" dstip=8.6.4.7 dstport=6000 dstintf="wan1" dstintfrole="wan" sessionid=4352 proto=17 action="accept" policyid=3426 policytype="policy" poluuid="1765de8-5a13-765da73fdsfa1c" policyname="newruleelastic" service="portname" dstcountry="Netherlands" srccountry="Reserved" trandisp="snat" transip=67.43.156.12 transport=60964 appcat="unknown" applist="policylist" duration=5462 sentbyte=438650 rcvdbyte=65446 sentpkt=723417 rcvdpkt=1045601 vwlid=0 sentdelta=576 rcvddelta=728
    - event.original: <~tmp.type>date=<~tmp.date> time=<~tmp.time> devname="<observer.name>" devid="<observer.serial_number>" logid="<event.code>" type="<~tmp.fortinet.firewall.type>" subtype="<~tmp.fortinet.firewall.subtype>" level="<log.level>" vd="<~tmp.fortinet.firewall.vd>" eventtime=<~> tz="<~tmp.tz>" srcip=<source.ip> srcport=<source.port> srcintf="<observer.ingress.interface.name>" srcintfrole="<~tmp.fortinet.firewall.srcintfrole>" dstip=<destination.ip> dstport=<destination.port> dstintf="<observer.egress.interface.name>" dstintfrole="<~tmp.fortinet.firewall.dstintfrole>" sessionid=<~tmp.fortinet.firewall.sessionid> proto=<network.iana_number> action="<event.action>" policyid=<rule.id> policytype="<rule.ruleset>" poluuid="<rule.uuid>" policyname="<rule.name>" service="<network.protocol>" dstcountry="<~tmp.fortinet.firewall.dstcountry>" srccountry="<~tmp.fortinet.firewall.srccountry>" trandisp="<~tmp.fortinet.firewall.trandisp>" transip=<source.nat.ip> transport=<source.nat.port> appcat="<rule.category>" applist="<~tmp.fortinet.firewall.applist>" duration=<event.duration> sentbyte=<source.bytes> rcvdbyte=<destination.bytes> sentpkt=<source.packets> rcvdpkt=<destination.packets> vwlid=<~tmp.fortinet.firewall.vwlid> sentdelta=<~tmp.fortinet.firewall.sentdelta> rcvddelta=<~tmp.fortinet.firewall.rcvddelta>
    # <189>date=2020-04-23 time=12:11:48 devname="newfirewall" devid="newrouterid" logid="0001000014" type="traffic" subtype="local" level="notice" vd="root" eventtime=1587229908751434997 tz="-0500" srcip=81.2.69.144 identifier=0 srcintf="port1" srcintfrole="lan" dstip=81.2.69.144 dstintf="unknown0" dstintfrole="undefined" sessionid=6542345 proto=58 action="accept" policyid=0 policytype="someotherpolicy" service="icmp6/1/0" trandisp="noop" app="icmp6/25/0" duration=42 sentbyte=3014 rcvdbyte=20 sentpkt=4 rcvdpkt=0 appcat="unscanned"
    # <189>date=2020-04-23 time=13:10:57 devname="newfirewall" devid="newrouterid" logid="0001000014" type="traffic" subtype="local" level="notice" vd="root" eventtime=1587229857509058693 tz="-0400" srcip=81.2.69.144 identifier=61 srcintf="wan1" srcintfrole="wan" dstip=175.16.199.1 dstintf="unknown0" dstintfrole="undefined" sessionid=123 proto=1 action="accept" policyid=0 policytype="rulepolicy" service="PING" dstcountry="Norway" srccountry="Netherlands" trandisp="noop" app="PING" duration=20 sentbyte=0 rcvdbyte=10 sentpkt=0 rcvdpkt=40 appcat="unscanned"
    - event.original: <~tmp.type>date=<~tmp.date> time=<~tmp.time> devname="<observer.name>" devid="<observer.serial_number>" logid="<event.code>" type="<~tmp.fortinet.firewall.type>" subtype="<~tmp.fortinet.firewall.subtype>" level="<log.level>" vd="<~tmp.fortinet.firewall.vd>" eventtime=<~> tz="<~tmp.tz>" srcip=<source.ip> identifier=<~tmp.fortinet.firewall.identifier> srcintf="<observer.ingress.interface.name>" srcintfrole="<~tmp.fortinet.firewall.srcintfrole>" dstip=<destination.ip> dstintf="<observer.egress.interface.name>" dstintfrole="<~tmp.fortinet.firewall.dstintfrole>" sessionid=<~tmp.fortinet.firewall.sessionid> proto=<network.iana_number> action="<event.action>" policyid=<rule.id> policytype="<rule.ruleset>" service="<network.protocol>"<~/ignore/ >(?dstcountry="<~tmp.fortinet.firewall.dstcountry>" srccountry="<~tmp.fortinet.firewall.srccountry>")<~/ignore/ >trandisp="<~tmp.fortinet.firewall.trandisp>" app="<network.application>" duration=<event.duration> sentbyte=<source.bytes> rcvdbyte=<destination.bytes> sentpkt=<source.packets> rcvdpkt=<destination.packets> appcat="<rule.category>"

normalize:
  - map:
    - event.dataset: fortinet.firewall
    - event.module: fortinet
    - event.outcome: sucess
    - event.timezone: $~tmp.tz
    - related.ip: [$source.ip]
    - related.user: [$source.user.name]
  - check:
    - log.level: error
    map:
      - event.outcome: failure
  - check:
    - ~tmp.fortinet.firewall.subtype: user
    - event.action: +r_match/(?i)logon
    map:
      - event.type: [start, user]
  - check:
    - ~tmp.fortinet.firewall.subtype: user
    - event.action: +r_match/(?i)logoff
    map:
      - event.type: [end, user]
  - map:
    - event.category: [authentication]
  - check:
    - ~tmp.fortinet.firewall.subtype: system
    map:
      - event.category: [host]
      - event.type: [info]
      - event.outcome: +ef_delete
  - check:
    - ~tmp.fortinet.firewall.subtype: vpn
    map:
      - event.category: [network]
      - event.type: [connection]
  - check:
    - ~tmp.fortinet.firewall.type: traffic
    map:
      - event.category: [network]
  - check:
    - ~tmp.fortinet.firewall.type: traffic
    map:
      - event.type: [connection]
      - event.kind: event
  - check:
    - ~tmp.fortinet.firewall.type: traffic
    - event.action: deny
    map:
      - event.type: +a_append/denied
  - check:
    - ~tmp.fortinet.firewall.type: traffic
    - event.action: +s_ne/deny
    map:
      - event.type: +a_append/allowed
  - check:
    - ~tmp.fortinet.firewall.type: traffic
    - event.action: +s_eq/start
    map:
      - event.type: +a_append/start
  - check:
    - ~tmp.fortinet.firewall.type: traffic
    - event.action: +s_ne/start
    map:
      - event.type: +a_append/end
  - check:
    - ~tmp.fortinet.firewall.type: traffic
    - event.action: +s_ne/deny
    - network.application: +ef_exists
    map:
      - event.type: +a_append/protocol
  - map:
    - ~tmp.timestamp: +s_concat/$~tmp.date/T/$~tmp.time/.000
  - check:
    - ~tmp.tz: +ef_exists
    map:
      - ~tmp.timestamp: +s_concat/$~tmp.date/T/$~tmp.time/.000/$~tmp.tz
  - check:
    - destination.ip: +ef_exists
    - ~tmp.fortinet.firewall.type: traffic
  #  - ~tmp.fortinet.firewall.subtype: +s_ne/local
    map:
      - related.ip: +a_append/$destination.ip
  - map:
    - fortinet.firewall.type: $event.kind
  - check:
    - ~tmp.fortinet.firewall.type: traffic
    map:
      - fortinet.firewall.type: $~tmp.fortinet.firewall.type
  - check:
    - ~tmp.fortinet.firewall.type: traffic
    - network.packets: +ef_not_exists
    - source.packets: +ef_exists
    map:
    - network.packets: $source.packets
  # TODO: can't multiply by 100000000
  # - check:
  #   - event.duration: +ef_exists
  #   map:
  #   - event.duration: +i_calc/mul/100000000
  - map:
      - \@timestamp: $~tmp.timestamp
      - event.start: $~tmp.timestamp
      - fileset.name: firewall
      - fortinet.firewall.addrgrp: $~tmp.fortinet.firewall.addrgrp
      - fortinet.firewall.fctemssn: $~tmp.fortinet.firewall.fctemssn
      - fortinet.firewall.action: $event.action
      - fortinet.firewall.craction: $~tmp.fortinet.firewall.craction
      - fortinet.firewall.crlevel: $~tmp.fortinet.firewall.crlevel
      - fortinet.firewall.crscore: $~tmp.fortinet.firewall.crscore
      - fortinet.firewall.dstcountry: $~tmp.fortinet.firewall.dstcountry
      - fortinet.firewall.srccountry: $~tmp.fortinet.firewall.srccountry
      - fortinet.firewall.dstintfrole: $~tmp.fortinet.firewall.dstintfrole
      - fortinet.firewall.sessionid: $~tmp.fortinet.firewall.sessionid
      - fortinet.firewall.srcintfrole: $~tmp.fortinet.firewall.srcintfrole
      - fortinet.firewall.trandisp: $~tmp.fortinet.firewall.trandisp
      - fortinet.firewall.method: $~tmp.fortinet.firewall.method
      - fortinet.firewall.profile: $~tmp.fortinet.firewall.profile
      - fortinet.firewall.sn: $~tmp.fortinet.firewall.sn
      - fortinet.firewall.connection_type: $~tmp.fortinet.firewall.connection_type
      - fortinet.firewall.count: $~tmp.fortinet.firewall.count
      - fortinet.firewall.fctuid: $~tmp.fortinet.firewall.fctuid
      - fortinet.firewall.ip: $~tmp.fortinet.firewall.ip
      - fortinet.firewall.license_limit: $~tmp.fortinet.firewall.license_limit
      - fortinet.firewall.name: $~tmp.fortinet.firewall.name
      - fortinet.firewall.cookies: $~tmp.fortinet.firewall.cookies
      - fortinet.firewall.init: $~tmp.fortinet.firewall.init
      - fortinet.firewall.mode: $~tmp.fortinet.firewall.mode
      - fortinet.firewall.outintf: $~tmp.fortinet.firewall.outintf
      - fortinet.firewall.result: $~tmp.fortinet.firewall.result
      - fortinet.firewall.role: $~tmp.fortinet.firewall.role
      - fortinet.firewall.stage: $~tmp.fortinet.firewall.stage
      - fortinet.firewall.peer_notif: $~tmp.fortinet.firewall.peer_notif
      - fortinet.firewall.bandwidth: $~tmp.fortinet.firewall.bandwidth
      - fortinet.firewall.cpu: $~tmp.fortinet.firewall.cpu
      - fortinet.firewall.disk: $~tmp.fortinet.firewall.disk
      - fortinet.firewall.disklograte: $~tmp.fortinet.firewall.disklograte
      - fortinet.firewall.fazlograte: $~tmp.fortinet.firewall.fazlograte
      - fortinet.firewall.freediskstorage: $~tmp.fortinet.firewall.freediskstorage
      - fortinet.firewall.mem: $~tmp.fortinet.firewall.mem
      - fortinet.firewall.setuprate: $~tmp.fortinet.firewall.setuprate
      - fortinet.firewall.sysuptime: $~tmp.fortinet.firewall.sysuptime
      - fortinet.firewall.totalsession: $~tmp.fortinet.firewall.totalsession
      - fortinet.firewall.authproto: $~tmp.fortinet.firewall.authproto
      - fortinet.firewall.interface: $~tmp.fortinet.firewall.interface
      - fortinet.firewall.status: $~tmp.fortinet.firewall.status
      - fortinet.firewall.subtype: $~tmp.fortinet.firewall.subtype
      - fortinet.firewall.tunnelid: $~tmp.fortinet.firewall.tunnelid
      - fortinet.firewall.tunnelip: $~tmp.fortinet.firewall.tunnelip
      - fortinet.firewall.tunneltype: $~tmp.fortinet.firewall.tunneltype
      - fortinet.firewall.ui: $~tmp.fortinet.firewall.ui
      - fortinet.firewall.vd: $~tmp.fortinet.firewall.vd
      - fortinet.firewall.used_for_type: $~tmp.fortinet.firewall.used_for_type
      - fortinet.firewall.vpntunnel: $~tmp.fortinet.firewall.vpntunnel
      - fortinet.firewall.authserver: $~tmp.fortinet.firewall.authserver
      - fortinet.firewall.server: $~tmp.fortinet.firewall.server
      - fortinet.firewall.version: $~tmp.fortinet.firewall.version
      - fortinet.firewall.applist: $~tmp.fortinet.firewall.applist
      - fortinet.firewall.app: $network.application
      - fortinet.firewall.rcvddelta: $~tmp.fortinet.firewall.rcvddelta
      - fortinet.firewall.sentdelta: $~tmp.fortinet.firewall.sentdelta
      - fortinet.firewall.vwlid: $~tmp.fortinet.firewall.vwlid
      - fortinet.firewall.identifier: $~tmp.fortinet.firewall.identifier
      - fortinet.firewall.appid: $~tmp.fortinet.firewall.appid
      - fortinet.firewall.apprisk: $~tmp.fortinet.firewall.apprisk
      - fortinet.firewall.appact: $~tmp.fortinet.firewall.appact
      - fortinet.firewall.vwlquality: $~tmp.fortinet.firewall.vwlquality
      - fortinet.firewall.wanin: $~tmp.fortinet.firewall.wanin
      - fortinet.firewall.wanout: $~tmp.fortinet.firewall.wanout
      - fortinet.firewall.lanin: $~tmp.fortinet.firewall.lanin
      - fortinet.firewall.lanout: $~tmp.fortinet.firewall.lanout
      - fortinet.firewall.utmaction: $~tmp.fortinet.firewall.utmaction
      - fortinet.firewall.countweb: $~tmp.fortinet.firewall.countweb
      - fortinet.firewall.countapp: $~tmp.fortinet.firewall.countapp
      - fortinet.firewall.countips: $~tmp.fortinet.firewall.countips
      - fortinet.firewall.utmref: $~tmp.fortinet.firewall.utmref
      - input.type: log
      - network.bytes: $source.bytes
      # TODO: Failed to assign field 'network.community id' because value not found in event
      - network.community_id: "1:8bNES6YDdszaPi28xM3VcSwJdbg="
      # TODO: Failed to assign field 'network.transport' because value not found in event
      - network.transport: udp/tcp
      # TODO: Could not map field 'log.offset' due to inability to persist values into yml variables.
      # Also, there is no helper that allows obtaining the size of an event.
      - log.offset: 0
      - network.direction: $~tmp.dir
      - observer.product: Fortigate
      - observer.type: firewall
      - observer.vendor: Fortinet
      # TODO: There is no geolocation information to be able to decode this segment of the event
      # <189>date=2020-04-23 time=12:32:31 devname="testswitch3" devid="someotherrouteridagain" logid="0101037127" type="event" subtype="vpn" level="notice" vd="root" eventtime=1587231151628960857 tz="-0500" logdesc="Progress IPsec phase 1" msg="progress IPsec phase 1" action="negotiate" remip=8.4.5.4 locip=1.128.3.4 remport=500 locport=500 outintf="wan1" cookies="df868dsg876d/0000000000000000" user="N/A" group="N/A" xauthuser="N/A" xauthgroup="N/A" assignip=N/A vpntunnel="elasticvpn" status="success" init="local" mode="main" dir="outbound" stage=1 role="initiator" result="OK"
      # - source.geo.city_name": "Changchun"
      # - source.geo.continent_name": "Asia"
      # - source.geo.country_iso_code": "CN"
      # - source.geo.country_name": "China"
      # - source.geo.location.lat": 43.88
      # - source.geo.location.lon": 125.3228
      # - source.geo.region_iso_code": "CN-22"
      # - source.geo.region_name": "Jilin Sheng"
      # - source.as.number": 1221
      # - source.as.organization.name": "Telstra Pty Ltd"

      # TODO: There is no geolocation information to be able to decode this segment of the event
      # <189>date=2020-04-23 time=01:16:08 devname="testswitch1" devid="somerouterid" logid="0000000013" type="traffic" subtype="forward" level="notice" vd="OPERATIONAL" eventtime=1592961368 srcip=10.10.10.10 srcport=60899 srcintf="srcintfname" srcintfrole="lan" dstip=175.16.199.1 dstport=161 dstintf="dstintfname" dstintfrole="lan" sessionid=155313 proto=17 action="deny" policyid=0 policytype="policy" service="SNMP" dstcountry="Reserved" srccountry="Reserved" trandisp="noop" duration=0 sentbyte=0 rcvdbyte=0 sentpkt=0 appcat="unscanned" crscore=30 craction=131072 crlevel="high"
      # - destination.geo.city_name": "Changchun"
      # - destination.geo.continent_name": "Asia"
      # - destination.geo.country_iso_code": "CN"
      # - destination.geo.country_name": "China"
      # - destination.geo.location.lat": 43.88
      # - destination.geo.location.lon": 125.3228
      # - destination.geo.region_iso_code": "CN-22"
      # - destination.geo.region_name": "Jilin Sheng"
      - service.type: fortinet
      - tags: [fortinet-firewall, forwarded]
  - check:
    - source.ip: +ef_exists
    map:
      - ~tmp.ip: +s_ip_version/$source.ip
  - check:
    - destination.ip: +ef_exists
    - source.ip: +ef_not_exists
    map:
      - ~tmp.ip: +s_ip_version/$destination.ip
  - map:
    - network.type: +s_lo/$~tmp.ip
    - ~tmp: +ef_delete