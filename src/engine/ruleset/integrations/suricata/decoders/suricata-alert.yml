name: decoder/suricata-alert/0

parents:
  - decoder/suricata/0

metadata:
  module: suricata
  compatibility: v6.0.0 and higher
  versions:
    - "6.0.0"
    - "7.0.0"

  author:
    name: Wazuh Inc, info@wazuh.com
    date: Nov 18 2022
  references:
    - https://suricata.readthedocs.io/en/suricata-6.0.8/output/eve/eve-json-format.html?highlight=eve%20format
  title: Suricata decoder
  description: Decoder for Suricata solution

check:
  - json_event.event_type: string_equal(alert)

normalize:
  - map:
      - event.category: array_append(intrusion_detection)
      - event.dataset: suricata.alert
      - event.kind: alert
      - event.type: array_append(detail)
      - wazuh.decoders: array_append(suricata-alert)

      - event.severity: $json_event.alert.severity
      - file.name: $json_event.alert.metadata.filename
      - rule.category: $json_event.alert.category
      - rule.id: $json_event.alert.signature_id
      - rule.name: $json_event.alert.signature
      - threat.tactic.id: $json_event.alert.metadata.mitre_tactic_id
      - threat.tactic.name: $json_event.alert.metadata.mitre_tactic_name
      - threat.technique.id: $json_event.alert.metadata.mitre_technique_id
      - threat.technique.name: $json_event.alert.metadata.mitre_technique_name

  - check: $source.bytes>=0 OR $destination.bytes>=0
    map:
      - network.bytes: 0
      - network.bytes: int_calculate(sum, $source.bytes, $destination.bytes)

  - check: $source.packets>=0 OR $destination.packets>=0
    map:
      - network.packets: 0
      - network.packets: int_calculate(sum, $source.packets, $destination.packets)

  - check:
      - json_event.alert.action: is_not_null()
    map:
      - event.type: array_append($json_event.alert.action)

  - map:
      - http.request.method: $json_event.http.http_method
      - http.request.referrer: $json_event.http.url
      - http.response.bytes: $json_event.http.lenght
      - http.response.mime_type: $json_event.http.http_content_type
      - http.response.status_code: $json_event.http.status
      - http.version: $json_event.http.protocol
      - related.hosts: array_append($json_event.http.hostname)
      - user_agent.original: $json_event.http.http_user_agent

  - map:
      - json_event: delete()
