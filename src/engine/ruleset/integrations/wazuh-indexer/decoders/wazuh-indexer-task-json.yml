name: decoder/wazuh-indexer-task-json/0

metadata:
  module: wazuh-indexer
  title: Wazuh indexer task logs
  description: Decoder for Wazuh indexer task logs in JSON format
  compatibility: This decoder has been tested with logs from Wazuh version 4.4
  versions:
    - "4.4"
  author:
    name: Wazuh Inc.
    email: info@wazuh.com
    date: 2023-07-03
  references:
    - "https://documentation.wazuh.com/current/getting-started/components/wazuh-indexer.html"
    - "https://opensearch.org/docs/latest/monitoring-your-cluster/logs/"

sources:
  - decoder/integrations/0

check:
  - ~json.type: direct
  - ~json.cluster\.name: +exists
  # TODO: Once the events arrive tagged, uncomment the following two lines
  # - event.module: wazuh-indexer
  # - event.dataset: wazuh-indexer-task

normalize:
  - map:
      - event.module: wazuh-indexer
      - event.dataset: wazuh-indexer-task
      - wazuh.decoders: +array_append/wazuh-indexer-task-json
      - '@timestamp': $~json.timestamp
      - event.created: $~json.timestamp
      - event.kind: event
      - event.category: +array_append/database
      - event.type: +array_append/info
      - log.level: $~json.level
      - log.logger: $~json.component
      - host.name: $~json.node\.name
      - host.id: $~json.node\.id
      - ~cluster.name: $~json.cluster\.name
      - ~cluster.uuid: $~json.cluster\.uuid
      - ~node.name: $~json.node\.name
      - ~node.id: $~json.node\.id
      - message: $~json.message
      - ~task.type: $~json.type
      - ~task.id: $~json.taskId
      - ~task.action: $~json.action
      - ~task.description: $~json.description
      - ~task.start_time_millis: $~json.start_time_millis
      - ~task.resource_stats: $~json.resource_stats
      - ~task.metadata: $~json.metadata
      - ~json: +delete
