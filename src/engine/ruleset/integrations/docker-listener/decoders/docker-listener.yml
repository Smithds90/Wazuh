name: decoder/docker-listener/0

metadata:
  title: Wazuh docker listener integration
  description: Process events that comes from the Docker listener wodle
  module: Docker-listener
  compatibility: >
    This decoder has been tested on Wazuh version 4.4 and docker 20.10.12
  versions:
   - "4.4"
   - "20.10.12" #TODO: check backward compatibility
  author:
    email: info@wazuh.com
    name: Wazuh, Inc.
    date: 2023-06-01
  references:
    - https://documentation.wazuh.com/current/container-security/docker-monitor/index.html
    - https://docs.docker.com/engine/reference/commandline/events/

sources:
  - decoder/integrations/0

check:
  - wazuh.origin: Wazuh-Docker
  - event.original: +starts_with/{

parse:
  logpar:
    - event.original: <~json/json>

normalize:

 - map:
    - wazuh.decoders: +array_append/docker-listener

 - check: +exists/~json.docker
   map:
    - container.id: $~json.docker.id
    - container.image.name: $~json.docker.from
    - service.origin.type: $~json.docker.Type
    - process.command_line: $~json.docker.status
    - process.exit_code: $~json.docker.exitCode
    - process.pid: $~json.docker.execID
    - event.duration: $~json.docker.execDuration
    - event.created: +date_from_epoch/$~json.docker.time
    - event.action: $~json.docker.Action
    - event.outcome: unknown
    - event.category: +array_append/process
    - event.kind: event
    - event.module: docker-listener

    # Custom field
    - ~container.attributes: $~json.docker.Actor.Attributes

    #cleanup
    - ~json: +delete

