name: decoder/windows_event_decoder/0

sources: 
  - decoder/queue-windows/0

metadata:
  description: Parent decoder for Windows events  

check:
  - ~parsed_json.Event: +ef_exists

parse:
  logpar:
    - ~parsed_json.Event: <~windows/xml/windows>

normalize:
 - map:
   - timestamp: $~windows.Event.System.TimeCreated.@SystemTime
   - event.code: $~windows.Event.System.EventID.#text
   - event.message: $~parsed_json.Message
   - event.kind: event
   - event.provider: $~windows.Event.System.Provider.@Name
   - host.name: $~windows.Event.System.Computer.#text
   - log.level: +kvdb_get/win_log_level/$~windows.Event.System.Level.#text
   - log.channel: $~windows.Event.System.Channel.#text
   - log.process.pid: $~windows.Event.System.Execution.@ProcessID
   - log.process.thread.id: $~windows.Event.System.Execution.@ThreadID
   - log.record_id: $~windows.Event.System.EventRecordID.#text
   - log.event_data: $~windows.Event.EventData

# Cleanup
 - map:
   - ~parsed_json: +ef_delete