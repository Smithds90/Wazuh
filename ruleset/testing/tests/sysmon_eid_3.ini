[Powershell process communicating over TCP]
log 1 pass = {"win":{"eventdata":{"destinationPort":"8080","image":"C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe","sourcePort":"50152","initiated":"true","destinationIp":"192.168.0.4","protocol":"tcp","processGuid":"{4dc16835-e854-6116-9224-950000000000}","sourceIp":"192.168.0.121","processId":"5888","utcTime":"2021-08-13 21:47:01.587","ruleName":"technique_id=T1059.001,technique_name=PowerShell","destinationIsIpv6":"false","user":"EXCHANGETEST\\\\AtomicRed","sourceIsIpv6":"false"},"system":{"eventID":"3","keywords":"0x8000000000000000","providerGuid":"{5770385f-c22a-43e0-bf4c-06f5698ffbd9}","level":"4","channel":"Microsoft-Windows-Sysmon/Operational","opcode":"0","message":"\"Network connection detected:\r\nRuleName: technique_id=T1059.001,technique_name=PowerShell\r\nUtcTime: 2021-08-13 21:47:01.587\r\nProcessGuid: {4dc16835-e854-6116-9224-950000000000}\r\nProcessId: 5888\r\nImage: C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\r\nUser: EXCHANGETEST\\AtomicRed\r\nProtocol: tcp\r\nInitiated: true\r\nSourceIsIpv6: false\r\nSourceIp: 192.168.0.121\r\nSourceHostname: -\r\nSourcePort: 50152\r\nSourcePortName: -\r\nDestinationIsIpv6: false\r\nDestinationIp: 192.168.0.4\r\nDestinationHostname: -\r\nDestinationPort: 8080\r\nDestinationPortName: -\"","version":"5","systemTime":"2021-08-13T21:47:02.6323067Z","eventRecordID":"346207","threadID":"3316","computer":"hrmanager.ExchangeTest.com","task":"3","processID":"2668","severityValue":"INFORMATION","providerName":"Microsoft-Windows-Sysmon"}}}
rule = 92070
alert = 0
decoder = json

[DCOM/RPC activity from Powershell process]
log 1 pass = {"win":{"eventdata":{"destinationPort":"135","image":"C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe","sourcePort":"49815","initiated":"true","destinationIp":"192.168.0.57","protocol":"tcp","processGuid":"{4dc16835-60aa-6094-3701-000000003800}","sourceIp":"192.168.0.121","processId":"1852","utcTime":"2021-05-06 21:35:16.032","ruleName":"technique_id=T1059.001,technique_name=PowerShell","destinationIsIpv6":"false","user":"EXCHANGETEST\\\\Administrator","sourceIsIpv6":"false"},"system":{"eventID":"3","keywords":"0x8000000000000000","providerGuid":"{5770385f-c22a-43e0-bf4c-06f5698ffbd9}","level":"4","channel":"Microsoft-Windows-Sysmon/Operational","opcode":"0","message":"\"Network connection detected:\r\nRuleName: technique_id=T1059.001,technique_name=PowerShell\r\nUtcTime: 2021-05-06 21:35:16.032\r\nProcessGuid: {4dc16835-60aa-6094-3701-000000003800}\r\nProcessId: 1852\r\nImage: C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\r\nUser: EXCHANGETEST\\Administrator\r\nProtocol: tcp\r\nInitiated: true\r\nSourceIsIpv6: false\r\nSourceIp: 192.168.0.121\r\nSourceHostname: -\r\nSourcePort: 49815\r\nSourcePortName: -\r\nDestinationIsIpv6: false\r\nDestinationIp: 192.168.0.57\r\nDestinationHostname: -\r\nDestinationPort: 135\r\nDestinationPortName: -\"","version":"5","systemTime":"2021-05-06T21:35:17.0534150Z","eventRecordID":"185918","threadID":"2944","computer":"hrmanager.ExchangeTest.com","task":"3","processID":"2140","severityValue":"INFORMATION","providerName":"Microsoft-Windows-Sysmon"}}}
rule = 92071
alert = 6
decoder = json

[LDAP activity from Powershell process]
log 1 pass = {"win":{"eventdata":{"destinationPort":"389","image":"C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe","sourcePort":"56704","initiated":"true","destinationIp":"192.168.0.57","protocol":"tcp","processGuid":"{4dc16835-5bcf-6091-b801-000000003500}","sourceIp":"192.168.0.121","processId":"5912","utcTime":"2021-05-04 15:04:59.139","ruleName":"technique_id=T1059.001,technique_name=PowerShell","destinationIsIpv6":"false","user":"EXCHANGETEST\\\\AtomicRed","sourceIsIpv6":"false"},"system":{"eventID":"3","keywords":"0x8000000000000000","providerGuid":"{5770385f-c22a-43e0-bf4c-06f5698ffbd9}","level":"4","channel":"Microsoft-Windows-Sysmon/Operational","opcode":"0","message":"\"Network connection detected:\r\nRuleName: technique_id=T1059.001,technique_name=PowerShell\r\nUtcTime: 2021-05-04 15:04:59.139\r\nProcessGuid: {4dc16835-5bcf-6091-b801-000000003500}\r\nProcessId: 5912\r\nImage: C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\r\nUser: EXCHANGETEST\\AtomicRed\r\nProtocol: tcp\r\nInitiated: true\r\nSourceIsIpv6: false\r\nSourceIp: 192.168.0.121\r\nSourceHostname: -\r\nSourcePort: 56704\r\nSourcePortName: -\r\nDestinationIsIpv6: false\r\nDestinationIp: 192.168.0.57\r\nDestinationHostname: -\r\nDestinationPort: 389\r\nDestinationPortName: -\"","version":"5","systemTime":"2021-05-04T15:05:00.3201980Z","eventRecordID":"169292","threadID":"3052","computer":"hrmanager.ExchangeTest.com","task":"3","processID":"2432","severityValue":"INFORMATION","providerName":"Microsoft-Windows-Sysmon"}}}
rule = 92072
alert = 6
decoder = json

[Windows System process activity over SMB port]
log 1 pass = {"win":{"eventdata":{"destinationPort":"445","image":"System","sourcePort":"51970","initiated":"false","destinationIp":"192.168.0.57","protocol":"tcp","processGuid":"{86107A5D-0B6A-60D6-EB03-000000000000}","sourceIp":"192.168.0.218","processId":"4","utcTime":"2021-06-25 18:34:36.226","destinationPortName":"microsoft-ds","ruleName":"technique_id=T1021.002,technique_name=Remote Services: SMB/Windows Admin Shares","destinationIsIpv6":"false","user":"NT AUTHORITY\\\\SYSTEM","sourceIsIpv6":"false"},"system":{"eventID":"3","keywords":"0x8000000000000000","providerGuid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","level":"4","channel":"Microsoft-Windows-Sysmon/Operational","opcode":"0","message":"\"Network connection detected:\r\nRuleName: technique_id=T1021.002,technique_name=Remote Services: SMB/Windows Admin Shares\r\nUtcTime: 2021-06-25 18:34:36.226\r\nProcessGuid: {86107A5D-0B6A-60D6-EB03-000000000000}\r\nProcessId: 4\r\nImage: System\r\nUser: NT AUTHORITY\\SYSTEM\r\nProtocol: tcp\r\nInitiated: false\r\nSourceIsIpv6: false\r\nSourceIp: 192.168.0.218\r\nSourceHostname: -\r\nSourcePort: 51970\r\nSourcePortName: -\r\nDestinationIsIpv6: false\r\nDestinationIp: 192.168.0.57\r\nDestinationHostname: -\r\nDestinationPort: 445\r\nDestinationPortName: microsoft-ds\"","version":"5","systemTime":"2021-06-25T18:34:37.376008800Z","eventRecordID":"658731","threadID":"3792","computer":"bankdc.ExchangeTest.com","task":"3","processID":"2620","severityValue":"INFORMATION","providerName":"Microsoft-Windows-Sysmon"}}}
rule = 92103
alert = 3
decoder = json

[Script generated suspicious network activity over TCP protocol]
log 1 pass = {"win":{"system":{"providerName":"Microsoft-Windows-Sysmon","providerGuid":"{5770385f-c22a-43e0-bf4c-06f5698ffbd9}","eventID":"3","version":"5","level":"4","task":"3","opcode":"0","keywords":"0x8000000000000000","systemTime":"2021-04-28T20:12:51.1096098Z","eventRecordID":"144535","processID":"2204","threadID":"2944","channel":"Microsoft-Windows-Sysmon/Operational","computer":"DESKTOP-2QKFOBA","severityValue":"INFORMATION","message":"\"Network connection detected:\r\nRuleName: technique_id=T1202,technique_name=Indirect Command Execution\r\nUtcTime: 2021-04-28 20:12:52.061\r\nProcessGuid: {4dc16835-c18b-6089-a503-000000002e00}\r\nProcessId: 2488\r\nImage: C:\\Windows\\System32\\wscript.exe\r\nUser: DESKTOP-2QKFOBA\\AtomicRedTeamTest\r\nProtocol: tcp\r\nInitiated: true\r\nSourceIsIpv6: false\r\nSourceIp: 192.168.0.121\r\nSourceHostname: -\r\nSourcePort: 52094\r\nSourcePortName: -\r\nDestinationIsIpv6: false\r\nDestinationIp: 192.168.0.4\r\nDestinationHostname: -\r\nDestinationPort: 443\r\nDestinationPortName: -\""},"eventdata":{"ruleName":"technique_id=T1202,technique_name=Indirect Command Execution","utcTime":"2021-04-28 20:12:52.061","processGuid":"{4dc16835-c18b-6089-a503-000000002e00}","processId":"2488","image":"C:\\\\Windows\\\\System32\\\\wscript.exe","user":"DESKTOP-2QKFOBA\\\\AtomicRedTeamTest","protocol":"tcp","initiated":"true","sourceIsIpv6":"false","sourceIp":"192.168.0.121","sourcePort":"52094","destinationIsIpv6":"false","destinationIp":"192.168.0.4","destinationPort":"443"}}}
rule = 92040
alert = 4
decoder = json

[RDP port network activity]
log 1 pass = {"win":{"eventdata":{"destinationPort":"3389","image":"C:\\\\Windows\\\\System32\\\\svchost.exe","sourcePort":"54642","initiated":"false","destinationIp":"192.168.0.121","protocol":"tcp","processGuid":"{4dc16835-fe80-60ee-d322-300000000000}","sourceIp":"192.168.0.57","processId":"5836","utcTime":"2021-07-14 15:44:40.699","ruleName":"technique_id=T1021,technique_name=Remote Services","destinationIsIpv6":"false","user":"NT AUTHORITY\\\\NETWORK SERVICE","sourceIsIpv6":"false"},"system":{"eventID":"3","keywords":"0x8000000000000000","providerGuid":"{5770385f-c22a-43e0-bf4c-06f5698ffbd9}","level":"4","channel":"Microsoft-Windows-Sysmon/Operational","opcode":"0","message":"\"Network connection detected:\r\nRuleName: technique_id=T1021,technique_name=Remote Services\r\nUtcTime: 2021-07-14 15:44:40.699\r\nProcessGuid: {4dc16835-fe80-60ee-d322-300000000000}\r\nProcessId: 5836\r\nImage: C:\\Windows\\System32\\svchost.exe\r\nUser: NT AUTHORITY\\NETWORK SERVICE\r\nProtocol: tcp\r\nInitiated: false\r\nSourceIsIpv6: false\r\nSourceIp: 192.168.0.57\r\nSourceHostname: -\r\nSourcePort: 54642\r\nSourcePortName: -\r\nDestinationIsIpv6: false\r\nDestinationIp: 192.168.0.121\r\nDestinationHostname: -\r\nDestinationPort: 3389\r\nDestinationPortName: -\"","version":"5","systemTime":"2021-07-14T15:44:42.0974780Z","eventRecordID":"271706","threadID":"3068","computer":"hrmanager.ExchangeTest.com","task":"3","processID":"2112","severityValue":"INFORMATION","providerName":"Microsoft-Windows-Sysmon"}}}
rule = 92107
alert = 0
decoder = json

[Loopback IP RDP port network activity]
log 1 pass = {"win":{"eventdata":{"destinationPort":"3389","image":"C:\\\\Windows\\\\System32\\\\svchost.exe","sourcePort":"25387","initiated":"false","destinationIp":"0:0:0:0:0:0:0:1","protocol":"tcp","processGuid":"{86107A5D-6C0C-60DF-04DD-600100000000}","sourceIp":"0:0:0:0:0:0:0:1","processId":"7728","sourceHostname":"bankdc.ExchangeTest.com","utcTime":"2021-07-02 20:19:28.870","destinationPortName":"ms-wbt-server","ruleName":"technique_id=T1021,technique_name=Remote Services","destinationIsIpv6":"true","user":"NT AUTHORITY\\\\NETWORK SERVICE","destinationHostname":"bankdc.ExchangeTest.com","sourceIsIpv6":"true"},"system":{"eventID":"3","keywords":"0x8000000000000000","providerGuid":"{5770385F-C22A-43E0-BF4C-06F5698FFBD9}","level":"4","channel":"Microsoft-Windows-Sysmon/Operational","opcode":"0","message":"\"Network connection detected:\r\nRuleName: technique_id=T1021,technique_name=Remote Services\r\nUtcTime: 2021-07-02 20:19:28.870\r\nProcessGuid: {86107A5D-6C0C-60DF-04DD-600100000000}\r\nProcessId: 7728\r\nImage: C:\\Windows\\System32\\svchost.exe\r\nUser: NT AUTHORITY\\NETWORK SERVICE\r\nProtocol: tcp\r\nInitiated: false\r\nSourceIsIpv6: true\r\nSourceIp: 0:0:0:0:0:0:0:1\r\nSourceHostname: bankdc.ExchangeTest.com\r\nSourcePort: 25387\r\nSourcePortName: -\r\nDestinationIsIpv6: true\r\nDestinationIp: 0:0:0:0:0:0:0:1\r\nDestinationHostname: bankdc.ExchangeTest.com\r\nDestinationPort: 3389\r\nDestinationPortName: ms-wbt-server\"","version":"5","systemTime":"2021-07-02T20:19:29.969938200Z","eventRecordID":"1122514","threadID":"3504","computer":"bankdc.ExchangeTest.com","task":"3","processID":"2528","severityValue":"INFORMATION","providerName":"Microsoft-Windows-Sysmon"}}}
rule = 92108
alert = 15
decoder = json

[User logged using Remote Desktop Connection (RDP)]
log 1 pass = {"win":{"eventdata":{"subjectLogonId":"0x3e7","restrictedAdminMode":"%%1843","subjectDomainName":"EXCHANGETEST","targetLinkedLogonId":"0x0","impersonationLevel":"%%1833","ipAddress":"::1","authenticationPackageName":"Negotiate","workstationName":"BANKDC","targetLogonId":"0x4105aff","logonProcessName":"User32","logonGuid":"{64C35E00-1827-0FCE-2AE0-11E54FFE301F}","targetUserName":"Administrator","keyLength":"0","elevatedToken":"%%1842","subjectUserSid":"S-1-5-18","processId":"0x464","processName":"C:\\\\Windows\\\\System32\\\\svchost.exe","ipPort":"0","targetDomainName":"EXCHANGETEST","targetUserSid":"S-1-5-21-887924094-598891991-956377308-500","virtualAccount":"%%1843","logonType":"10","subjectUserName":"BANKDC$"},"system":{"eventID":"4624","keywords":"0x8020000000000000","providerGuid":"{54849625-5478-4994-A5BA-3E3B0328C30D}","level":"0","channel":"Security","opcode":"0","message":"\"An account was successfully logged on.\r\n\r\nSubject:\r\n\tSecurity ID:\t\tS-1-5-18\r\n\tAccount Name:\t\tBANKDC$\r\n\tAccount Domain:\t\tEXCHANGETEST\r\n\tLogon ID:\t\t0x3E7\r\n\r\nLogon Information:\r\n\tLogon Type:\t\t10\r\n\tRestricted Admin Mode:\tNo\r\n\tVirtual Account:\t\tNo\r\n\tElevated Token:\t\tYes\r\n\r\nImpersonation Level:\t\tImpersonation\r\n\r\nNew Logon:\r\n\tSecurity ID:\t\tS-1-5-21-887924094-598891991-956377308-500\r\n\tAccount Name:\t\tAdministrator\r\n\tAccount Domain:\t\tEXCHANGETEST\r\n\tLogon ID:\t\t0x4105AFF\r\n\tLinked Logon ID:\t\t0x0\r\n\tNetwork Account Name:\t-\r\n\tNetwork Account Domain:\t-\r\n\tLogon GUID:\t\t{64C35E00-1827-0FCE-2AE0-11E54FFE301F}\r\n\r\nProcess Information:\r\n\tProcess ID:\t\t0x464\r\n\tProcess Name:\t\tC:\\Windows\\System32\\svchost.exe\r\n\r\nNetwork Information:\r\n\tWorkstation Name:\tBANKDC\r\n\tSource Network Address:\t::1\r\n\tSource Port:\t\t0\r\n\r\nDetailed Authentication Information:\r\n\tLogon Process:\t\tUser32 \r\n\tAuthentication Package:\tNegotiate\r\n\tTransited Services:\t-\r\n\tPackage Name (NTLM only):\t-\r\n\tKey Length:\t\t0\r\n\r\nThis event is generated when a logon session is created. It is generated on the computer that was accessed.\r\n\r\nThe subject fields indicate the account on the local system which requested the logon. This is most commonly a service such as the Server service, or a local process such as Winlogon.exe or Services.exe.\r\n\r\nThe logon type field indicates the kind of logon that occurred. The most common types are 2 (interactive) and 3 (network).\r\n\r\nThe New Logon fields indicate the account for whom the new logon was created, i.e. the account that was logged on.\r\n\r\nThe network fields indicate where a remote logon request originated. Workstation name is not always available and may be left blank in some cases.\r\n\r\nThe impersonation level field indicates the extent to which a process in the logon session can impersonate.\r\n\r\nThe authentication information fields provide detailed information about this specific logon request.\r\n\t- Logon GUID is a unique identifier that can be used to correlate this event with a KDC event.\r\n\t- Transited services indicate which intermediate services have participated in this logon request.\r\n\t- Package name indicates which sub-protocol was used among the NTLM protocols.\r\n\t- Key length indicates the length of the generated session key. This will be 0 if no session key was requested.\"","version":"2","systemTime":"2021-07-02T20:19:32.631853500Z","eventRecordID":"4200219","threadID":"720","computer":"bankdc.ExchangeTest.com","task":"12544","processID":"556","severityValue":"AUDIT_SUCCESS","providerName":"Microsoft-Windows-Security-Auditing"}}}
rule = 92065
alert = 15
decoder = json